"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/uploadthing";
exports.ids = ["vendor-chunks/uploadthing"];
exports.modules = {

/***/ "(ssr)/./node_modules/uploadthing/client/index.js":
/*!**************************************************!*\
  !*** ./node_modules/uploadthing/client/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UploadAbortedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError),\n/* harmony export */   UploadPausedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError),\n/* harmony export */   genUploader: () => (/* binding */ genUploader),\n/* harmony export */   generateClientDropzoneAccept: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateClientDropzoneAccept),\n/* harmony export */   generateMimeTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateMimeTypes),\n/* harmony export */   generatePermittedFileTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generatePermittedFileTypes),\n/* harmony export */   isValidFileSize: () => (/* binding */ isValidFileSize),\n/* harmony export */   isValidFileType: () => (/* binding */ isValidFileType),\n/* harmony export */   version: () => (/* binding */ version)\n/* harmony export */ });\n/* harmony import */ var effect_Array__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/Array */ \"(ssr)/./node_modules/effect/dist/esm/Array.js\");\n/* harmony import */ var effect_Micro__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Micro */ \"(ssr)/./node_modules/effect/dist/esm/Micro.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @uploadthing/shared */ \"(ssr)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_Function__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! effect/Function */ \"(ssr)/./node_modules/effect/dist/esm/Function.js\");\n\n\n\n\n\n\nvar version$1 = \"7.2.0\";\n\nconst createDeferred = ()=>{\n    let resolve;\n    let reject;\n    const ac = new AbortController();\n    const promise = new Promise((res, rej)=>{\n        resolve = res;\n        reject = rej;\n    });\n    return {\n        promise,\n        ac,\n        resolve,\n        reject\n    };\n};\n\nconst createAPIRequestUrl = (config)=>{\n    const url = new URL(config.url);\n    const queryParams = new URLSearchParams(url.search);\n    queryParams.set(\"actionType\", config.actionType);\n    queryParams.set(\"slug\", config.slug);\n    url.search = queryParams.toString();\n    return url;\n};\n/**\n * Creates a \"client\" for reporting events to the UploadThing server via the user's API endpoint.\n * Events are handled in \"./handler.ts starting at L112\"\n */ const createUTReporter = (cfg)=>(type, payload)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.gen(function*() {\n            const url = createAPIRequestUrl({\n                url: cfg.url,\n                slug: cfg.endpoint,\n                actionType: type\n            });\n            const headers = new Headers((yield* effect_Micro__WEBPACK_IMPORTED_MODULE_1__.promise(async ()=>typeof cfg.headers === \"function\" ? await cfg.headers() : cfg.headers)));\n            headers.set(\"x-uploadthing-package\", cfg.package);\n            headers.set(\"x-uploadthing-version\", version$1);\n            headers.set(\"Content-Type\", \"application/json\");\n            const response = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(url, {\n                method: \"POST\",\n                body: JSON.stringify(payload),\n                headers\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), /**\n         * We don't _need_ to validate the response here, just cast it for now.\n         * As of now, @effect/schema includes quite a few bytes we cut out by this...\n         * We have \"strong typing\" on the backend that ensures the shape should match.\n         */ effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"FetchError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: `Failed to report event \"${type}\" to UploadThing server`,\n                    cause: e\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"BadRequestError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getErrorTypeFromStatusCode)(e.status),\n                    message: e.getMessage(),\n                    cause: e.json\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"InvalidJson\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: \"Failed to parse response from UploadThing server\",\n                    cause: e\n                }))));\n            return response;\n        });\n\nconst uploadWithProgress = (file, rangeStart, presigned, onUploadProgress)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.async((resume)=>{\n        const xhr = new XMLHttpRequest();\n        xhr.open(\"PUT\", presigned.url, true);\n        xhr.setRequestHeader(\"Range\", `bytes=${rangeStart}-`);\n        xhr.setRequestHeader(\"x-uploadthing-version\", version$1);\n        xhr.responseType = \"json\";\n        let previousLoaded = 0;\n        xhr.upload.addEventListener(\"progress\", ({ loaded })=>{\n            const delta = loaded - previousLoaded;\n            onUploadProgress?.({\n                loaded,\n                delta\n            });\n            previousLoaded = loaded;\n        });\n        xhr.addEventListener(\"load\", ()=>{\n            resume(xhr.status >= 200 && xhr.status < 300 ? effect_Micro__WEBPACK_IMPORTED_MODULE_1__.succeed(xhr.response) : effect_Micro__WEBPACK_IMPORTED_MODULE_1__.die(`XHR failed ${xhr.status} ${xhr.statusText} - ${JSON.stringify(xhr.response)}`));\n        });\n        // Is there a case when the client would throw and\n        // ingest server not knowing about it? idts?\n        xhr.addEventListener(\"error\", ()=>{\n            resume(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"UPLOAD_FAILED\"\n            }));\n        });\n        const formData = new FormData();\n        formData.append(\"file\", file.slice(rangeStart));\n        xhr.send(formData);\n        return effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>xhr.abort());\n    });\nconst uploadFile = (file, presigned, opts)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(presigned.url, {\n        method: \"HEAD\"\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(({ headers })=>parseInt(headers.get(\"x-ut-range-start\") ?? \"0\", 10)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.tap((start)=>opts.onUploadProgress?.({\n            delta: start,\n            loaded: start\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((start)=>uploadWithProgress(file, start, presigned, (progressEvent)=>opts.onUploadProgress?.({\n                delta: progressEvent.delta,\n                loaded: progressEvent.loaded + start\n            }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((uploadResponse)=>({\n            name: file.name,\n            size: file.size,\n            key: presigned.key,\n            lastModified: file.lastModified,\n            serverData: uploadResponse.serverData,\n            url: uploadResponse.url,\n            appUrl: uploadResponse.appUrl,\n            customId: presigned.customId,\n            type: file.type,\n            fileHash: uploadResponse.fileHash\n        })));\nconst uploadFilesInternal = (endpoint, opts)=>{\n    // classic service right here\n    const reportEventToUT = createUTReporter({\n        endpoint: String(endpoint),\n        package: opts.package,\n        url: opts.url,\n        headers: opts.headers\n    });\n    const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n    let totalLoaded = 0;\n    return reportEventToUT(\"upload\", {\n        input: \"input\" in opts ? opts.input : null,\n        files: opts.files.map((f)=>({\n                name: f.name,\n                size: f.size,\n                type: f.type,\n                lastModified: f.lastModified\n            }))\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((presigneds)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.forEach(presigneds, (presigned, i)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>opts.onUploadBegin?.({\n                    file: opts.files[i].name\n                })), ()=>uploadFile(opts.files[i], presigned, {\n                    onUploadProgress: (ev)=>{\n                        totalLoaded += ev.delta;\n                        opts.onUploadProgress?.({\n                            file: opts.files[i],\n                            progress: Math.round(ev.loaded / opts.files[i].size * 100),\n                            loaded: ev.loaded,\n                            delta: ev.delta,\n                            totalLoaded,\n                            totalProgress: Math.round(totalLoaded / totalSize * 100)\n                        });\n                    }\n                })), {\n            concurrency: 6\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n};\n\nconst version = version$1;\n/**\n * Validate that a file is of a valid type given a route config\n * @public\n */ const isValidFileType = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((type)=>file.type.includes(type)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Validate that a file is of a valid size given a route config\n * @public\n */ const isValidFileSize = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((type)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fileSizeToBytes)(routeConfig[type].maxFileSize)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((maxFileSize)=>file.size <= maxFileSize), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Generate a typed uploader for a given FileRouter\n * @public\n */ const genUploader = (initOpts)=>{\n    const routeRegistry = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.createIdentityProxy)();\n    const controllableUpload = async (slug, opts)=>{\n        const uploads = new Map();\n        const endpoint = typeof slug === \"function\" ? slug(routeRegistry) : slug;\n        const utReporter = createUTReporter({\n            endpoint: String(endpoint),\n            package: initOpts.package,\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            headers: opts.headers\n        });\n        const presigneds = await effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromise(utReporter(\"upload\", {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            input: \"input\" in opts ? opts.input : null,\n            files: opts.files.map((f)=>({\n                    name: f.name,\n                    size: f.size,\n                    type: f.type,\n                    lastModified: f.lastModified\n                }))\n        }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch)));\n        const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n        let totalLoaded = 0;\n        const uploadEffect = (file, presigned)=>uploadFile(file, presigned, {\n                onUploadProgress: (progressEvent)=>{\n                    totalLoaded += progressEvent.delta;\n                    opts.onUploadProgress?.({\n                        ...progressEvent,\n                        file,\n                        progress: Math.round(progressEvent.loaded / file.size * 100),\n                        totalLoaded,\n                        totalProgress: Math.round(totalLoaded / totalSize * 100)\n                    });\n                }\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n        for (const [i, p] of presigneds.entries()){\n            const file = opts.files[i];\n            const deferred = createDeferred();\n            uploads.set(file, {\n                deferred,\n                presigned: p\n            });\n            void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, p), {\n                signal: deferred.ac.signal\n            }).then((result)=>{\n                if (result._tag === \"Right\") {\n                    return deferred.resolve(result.right);\n                } else if (result.left._tag === \"Interrupt\") {\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                }\n                throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.left);\n            }).catch((err)=>{\n                if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                deferred.reject(err);\n            });\n        }\n        /**\n     * Pause an ongoing upload\n     * @param file The file upload you want to pause. Can be omitted to pause all files\n     */ const pauseUpload = (file)=>{\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) return;\n                if (upload.deferred.ac.signal.aborted) {\n                    // Cancel the upload if it's already been paused\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n                }\n                upload.deferred.ac.abort();\n            }\n        };\n        /**\n     * Resume a paused upload\n     * @param file The file upload you want to resume. Can be omitted to resume all files\n     */ const resumeUpload = (file)=>{\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                upload.deferred.ac = new AbortController();\n                void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, upload.presigned), {\n                    signal: upload.deferred.ac.signal\n                }).then((result)=>{\n                    if (result._tag === \"Right\") {\n                        return upload.deferred.resolve(result.right);\n                    } else if (result.left._tag === \"Interrupt\") {\n                        throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                    }\n                    throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.left);\n                }).catch((err)=>{\n                    if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                    upload.deferred.reject(err);\n                });\n            }\n        };\n        /**\n     * Wait for an upload to complete\n     * @param file The file upload you want to wait for. Can be omitted to wait for all files\n     */ const done = async (file)=>{\n            const promises = [];\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                promises.push(upload.deferred.promise);\n            }\n            const results = await Promise.all(promises);\n            return file ? results[0] : results;\n        };\n        return {\n            pauseUpload,\n            resumeUpload,\n            done\n        };\n    };\n    /**\n   * One step upload function that both requests presigned URLs\n   * and then uploads the files to UploadThing\n   */ const typedUploadFiles = (slug, opts)=>{\n        const endpoint = typeof slug === \"function\" ? slug(routeRegistry) : slug;\n        return uploadFilesInternal(endpoint, {\n            ...opts,\n            skipPolling: {},\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            package: initOpts.package,\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            input: opts.input\n        }).pipe((effect)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(effect, opts.signal && {\n                signal: opts.signal\n            })).then((exit)=>{\n            if (exit._tag === \"Right\") {\n                return exit.right;\n            } else if (exit.left._tag === \"Interrupt\") {\n                throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n            }\n            throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(exit.left);\n        });\n    };\n    return {\n        uploadFiles: typedUploadFiles,\n        createUpload: controllableUpload,\n        /**\n     * Identity object that can be used instead of raw strings\n     * that allows \"Go to definition\" in your IDE to bring you\n     * to the backend definition of a route.\n     */ routeRegistry\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBb0M7QUFDRTtBQUNvTjtBQUNqRztBQUMxRzs7QUFFL0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCw2Q0FBUztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixnREFBZ0QsaURBQWE7QUFDN0Q7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDZEQUFRO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTyxpREFBYSxDQUFDLGtFQUFpQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZDQUFTLENBQUMseURBQVksR0FBRyxrREFBYyxvQkFBb0IsOENBQVUsS0FBSyxpRUFBZ0I7QUFDdEc7QUFDQSx3REFBd0QsS0FBSztBQUM3RDtBQUNBLGlCQUFpQixLQUFLLGtEQUFjLHlCQUF5Qiw4Q0FBVSxLQUFLLGlFQUFnQjtBQUM1RiwwQkFBMEIsK0VBQTBCO0FBQ3BEO0FBQ0E7QUFDQSxpQkFBaUIsS0FBSyxrREFBYyxxQkFBcUIsOENBQVUsS0FBSyxpRUFBZ0I7QUFDeEY7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUzs7QUFFVCw0RUFBNEUsK0NBQVc7QUFDdkY7QUFDQTtBQUNBLCtDQUErQyxXQUFXO0FBQzFEO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxRQUFRO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0EsMkRBQTJELGlEQUFhLGlCQUFpQiw2Q0FBUyxlQUFlLFlBQVksRUFBRSxnQkFBZ0IsSUFBSSw2QkFBNkI7QUFD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QTtBQUNBLDJCQUEyQjtBQUMzQixpQkFBaUIsdUVBQWtCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLFNBQVMsaUJBQWlCLHdEQUFvQjtBQUM5QztBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsY0FBYztBQUNkLDBCQUEwQixtRUFBa0I7QUFDNUM7QUFDQSxrQkFBa0IscURBQWlCO0FBQ25DLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVrRSIsInNvdXJjZXMiOlsid2VicGFjazovL3NhbXBsZTEvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzPzQzMzciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgQXJyIGZyb20gJ2VmZmVjdC9BcnJheSc7XG5pbXBvcnQgKiBhcyBNaWNybyBmcm9tICdlZmZlY3QvTWljcm8nO1xuaW1wb3J0IHsgZmV0Y2hFZmYsIHBhcnNlUmVzcG9uc2VKc29uLCBVcGxvYWRUaGluZ0Vycm9yLCBnZXRFcnJvclR5cGVGcm9tU3RhdHVzQ29kZSwgRmV0Y2hDb250ZXh0LCBtYXRjaEZpbGVUeXBlLCBvYmplY3RLZXlzLCBmaWxlU2l6ZVRvQnl0ZXMsIGNyZWF0ZUlkZW50aXR5UHJveHksIHJlc29sdmVNYXliZVVybEFyZywgVXBsb2FkUGF1c2VkRXJyb3IsIFVwbG9hZEFib3J0ZWRFcnJvciB9IGZyb20gJ0B1cGxvYWR0aGluZy9zaGFyZWQnO1xuZXhwb3J0IHsgVXBsb2FkQWJvcnRlZEVycm9yLCBVcGxvYWRQYXVzZWRFcnJvciwgZ2VuZXJhdGVDbGllbnREcm9wem9uZUFjY2VwdCwgZ2VuZXJhdGVNaW1lVHlwZXMsIGdlbmVyYXRlUGVybWl0dGVkRmlsZVR5cGVzIH0gZnJvbSAnQHVwbG9hZHRoaW5nL3NoYXJlZCc7XG5pbXBvcnQgeyB1bnNhZmVDb2VyY2UgfSBmcm9tICdlZmZlY3QvRnVuY3Rpb24nO1xuXG52YXIgdmVyc2lvbiQxID0gXCI3LjIuMFwiO1xuXG5jb25zdCBjcmVhdGVEZWZlcnJlZCA9ICgpPT57XG4gICAgbGV0IHJlc29sdmU7XG4gICAgbGV0IHJlamVjdDtcbiAgICBjb25zdCBhYyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlcywgcmVqKT0+e1xuICAgICAgICByZXNvbHZlID0gcmVzO1xuICAgICAgICByZWplY3QgPSByZWo7XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHJvbWlzZSxcbiAgICAgICAgYWMsXG4gICAgICAgIHJlc29sdmUsXG4gICAgICAgIHJlamVjdFxuICAgIH07XG59O1xuXG5jb25zdCBjcmVhdGVBUElSZXF1ZXN0VXJsID0gKGNvbmZpZyk9PntcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGNvbmZpZy51cmwpO1xuICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh1cmwuc2VhcmNoKTtcbiAgICBxdWVyeVBhcmFtcy5zZXQoXCJhY3Rpb25UeXBlXCIsIGNvbmZpZy5hY3Rpb25UeXBlKTtcbiAgICBxdWVyeVBhcmFtcy5zZXQoXCJzbHVnXCIsIGNvbmZpZy5zbHVnKTtcbiAgICB1cmwuc2VhcmNoID0gcXVlcnlQYXJhbXMudG9TdHJpbmcoKTtcbiAgICByZXR1cm4gdXJsO1xufTtcbi8qKlxuICogQ3JlYXRlcyBhIFwiY2xpZW50XCIgZm9yIHJlcG9ydGluZyBldmVudHMgdG8gdGhlIFVwbG9hZFRoaW5nIHNlcnZlciB2aWEgdGhlIHVzZXIncyBBUEkgZW5kcG9pbnQuXG4gKiBFdmVudHMgYXJlIGhhbmRsZWQgaW4gXCIuL2hhbmRsZXIudHMgc3RhcnRpbmcgYXQgTDExMlwiXG4gKi8gY29uc3QgY3JlYXRlVVRSZXBvcnRlciA9IChjZmcpPT4odHlwZSwgcGF5bG9hZCk9Pk1pY3JvLmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBjcmVhdGVBUElSZXF1ZXN0VXJsKHtcbiAgICAgICAgICAgICAgICB1cmw6IGNmZy51cmwsXG4gICAgICAgICAgICAgICAgc2x1ZzogY2ZnLmVuZHBvaW50LFxuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHR5cGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IG5ldyBIZWFkZXJzKCh5aWVsZCogTWljcm8ucHJvbWlzZShhc3luYyAoKT0+dHlwZW9mIGNmZy5oZWFkZXJzID09PSBcImZ1bmN0aW9uXCIgPyBhd2FpdCBjZmcuaGVhZGVycygpIDogY2ZnLmhlYWRlcnMpKSk7XG4gICAgICAgICAgICBoZWFkZXJzLnNldChcIngtdXBsb2FkdGhpbmctcGFja2FnZVwiLCBjZmcucGFja2FnZSk7XG4gICAgICAgICAgICBoZWFkZXJzLnNldChcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiLCB2ZXJzaW9uJDEpO1xuICAgICAgICAgICAgaGVhZGVycy5zZXQoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCogZmV0Y2hFZmYodXJsLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSxcbiAgICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICB9KS5waXBlKE1pY3JvLmFuZFRoZW4ocGFyc2VSZXNwb25zZUpzb24pLCAvKipcbiAgICAgICAgICogV2UgZG9uJ3QgX25lZWRfIHRvIHZhbGlkYXRlIHRoZSByZXNwb25zZSBoZXJlLCBqdXN0IGNhc3QgaXQgZm9yIG5vdy5cbiAgICAgICAgICogQXMgb2Ygbm93LCBAZWZmZWN0L3NjaGVtYSBpbmNsdWRlcyBxdWl0ZSBhIGZldyBieXRlcyB3ZSBjdXQgb3V0IGJ5IHRoaXMuLi5cbiAgICAgICAgICogV2UgaGF2ZSBcInN0cm9uZyB0eXBpbmdcIiBvbiB0aGUgYmFja2VuZCB0aGF0IGVuc3VyZXMgdGhlIHNoYXBlIHNob3VsZCBtYXRjaC5cbiAgICAgICAgICovIE1pY3JvLm1hcCh1bnNhZmVDb2VyY2UpLCBNaWNyby5jYXRjaFRhZyhcIkZldGNoRXJyb3JcIiwgKGUpPT5NaWNyby5mYWlsKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9DTElFTlRfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogYEZhaWxlZCB0byByZXBvcnQgZXZlbnQgXCIke3R5cGV9XCIgdG8gVXBsb2FkVGhpbmcgc2VydmVyYCxcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVcbiAgICAgICAgICAgICAgICB9KSkpLCBNaWNyby5jYXRjaFRhZyhcIkJhZFJlcXVlc3RFcnJvclwiLCAoZSk9Pk1pY3JvLmZhaWwobmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBnZXRFcnJvclR5cGVGcm9tU3RhdHVzQ29kZShlLnN0YXR1cyksXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGUuZ2V0TWVzc2FnZSgpLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZS5qc29uXG4gICAgICAgICAgICAgICAgfSkpKSwgTWljcm8uY2F0Y2hUYWcoXCJJbnZhbGlkSnNvblwiLCAoZSk9Pk1pY3JvLmZhaWwobmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX0NMSUVOVF9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBwYXJzZSByZXNwb25zZSBmcm9tIFVwbG9hZFRoaW5nIHNlcnZlclwiLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZVxuICAgICAgICAgICAgICAgIH0pKSkpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9KTtcblxuY29uc3QgdXBsb2FkV2l0aFByb2dyZXNzID0gKGZpbGUsIHJhbmdlU3RhcnQsIHByZXNpZ25lZCwgb25VcGxvYWRQcm9ncmVzcyk9Pk1pY3JvLmFzeW5jKChyZXN1bWUpPT57XG4gICAgICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICB4aHIub3BlbihcIlBVVFwiLCBwcmVzaWduZWQudXJsLCB0cnVlKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJSYW5nZVwiLCBgYnl0ZXM9JHtyYW5nZVN0YXJ0fS1gKTtcbiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIiwgdmVyc2lvbiQxKTtcbiAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9IFwianNvblwiO1xuICAgICAgICBsZXQgcHJldmlvdXNMb2FkZWQgPSAwO1xuICAgICAgICB4aHIudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoXCJwcm9ncmVzc1wiLCAoeyBsb2FkZWQgfSk9PntcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gbG9hZGVkIC0gcHJldmlvdXNMb2FkZWQ7XG4gICAgICAgICAgICBvblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgICAgIGxvYWRlZCxcbiAgICAgICAgICAgICAgICBkZWx0YVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBwcmV2aW91c0xvYWRlZCA9IGxvYWRlZDtcbiAgICAgICAgfSk7XG4gICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKT0+e1xuICAgICAgICAgICAgcmVzdW1lKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDAgPyBNaWNyby5zdWNjZWVkKHhoci5yZXNwb25zZSkgOiBNaWNyby5kaWUoYFhIUiBmYWlsZWQgJHt4aHIuc3RhdHVzfSAke3hoci5zdGF0dXNUZXh0fSAtICR7SlNPTi5zdHJpbmdpZnkoeGhyLnJlc3BvbnNlKX1gKSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBJcyB0aGVyZSBhIGNhc2Ugd2hlbiB0aGUgY2xpZW50IHdvdWxkIHRocm93IGFuZFxuICAgICAgICAvLyBpbmdlc3Qgc2VydmVyIG5vdCBrbm93aW5nIGFib3V0IGl0PyBpZHRzP1xuICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcihcImVycm9yXCIsICgpPT57XG4gICAgICAgICAgICByZXN1bWUobmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiVVBMT0FEX0ZBSUxFRFwiXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGZpbGUuc2xpY2UocmFuZ2VTdGFydCkpO1xuICAgICAgICB4aHIuc2VuZChmb3JtRGF0YSk7XG4gICAgICAgIHJldHVybiBNaWNyby5zeW5jKCgpPT54aHIuYWJvcnQoKSk7XG4gICAgfSk7XG5jb25zdCB1cGxvYWRGaWxlID0gKGZpbGUsIHByZXNpZ25lZCwgb3B0cyk9PmZldGNoRWZmKHByZXNpZ25lZC51cmwsIHtcbiAgICAgICAgbWV0aG9kOiBcIkhFQURcIlxuICAgIH0pLnBpcGUoTWljcm8ubWFwKCh7IGhlYWRlcnMgfSk9PnBhcnNlSW50KGhlYWRlcnMuZ2V0KFwieC11dC1yYW5nZS1zdGFydFwiKSA/PyBcIjBcIiwgMTApKSwgTWljcm8udGFwKChzdGFydCk9Pm9wdHMub25VcGxvYWRQcm9ncmVzcz8uKHtcbiAgICAgICAgICAgIGRlbHRhOiBzdGFydCxcbiAgICAgICAgICAgIGxvYWRlZDogc3RhcnRcbiAgICAgICAgfSkpLCBNaWNyby5mbGF0TWFwKChzdGFydCk9PnVwbG9hZFdpdGhQcm9ncmVzcyhmaWxlLCBzdGFydCwgcHJlc2lnbmVkLCAocHJvZ3Jlc3NFdmVudCk9Pm9wdHMub25VcGxvYWRQcm9ncmVzcz8uKHtcbiAgICAgICAgICAgICAgICBkZWx0YTogcHJvZ3Jlc3NFdmVudC5kZWx0YSxcbiAgICAgICAgICAgICAgICBsb2FkZWQ6IHByb2dyZXNzRXZlbnQubG9hZGVkICsgc3RhcnRcbiAgICAgICAgICAgIH0pKSksIE1pY3JvLm1hcCh1bnNhZmVDb2VyY2UpLCBNaWNyby5tYXAoKHVwbG9hZFJlc3BvbnNlKT0+KHtcbiAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgIGtleTogcHJlc2lnbmVkLmtleSxcbiAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5sYXN0TW9kaWZpZWQsXG4gICAgICAgICAgICBzZXJ2ZXJEYXRhOiB1cGxvYWRSZXNwb25zZS5zZXJ2ZXJEYXRhLFxuICAgICAgICAgICAgdXJsOiB1cGxvYWRSZXNwb25zZS51cmwsXG4gICAgICAgICAgICBhcHBVcmw6IHVwbG9hZFJlc3BvbnNlLmFwcFVybCxcbiAgICAgICAgICAgIGN1c3RvbUlkOiBwcmVzaWduZWQuY3VzdG9tSWQsXG4gICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICBmaWxlSGFzaDogdXBsb2FkUmVzcG9uc2UuZmlsZUhhc2hcbiAgICAgICAgfSkpKTtcbmNvbnN0IHVwbG9hZEZpbGVzSW50ZXJuYWwgPSAoZW5kcG9pbnQsIG9wdHMpPT57XG4gICAgLy8gY2xhc3NpYyBzZXJ2aWNlIHJpZ2h0IGhlcmVcbiAgICBjb25zdCByZXBvcnRFdmVudFRvVVQgPSBjcmVhdGVVVFJlcG9ydGVyKHtcbiAgICAgICAgZW5kcG9pbnQ6IFN0cmluZyhlbmRwb2ludCksXG4gICAgICAgIHBhY2thZ2U6IG9wdHMucGFja2FnZSxcbiAgICAgICAgdXJsOiBvcHRzLnVybCxcbiAgICAgICAgaGVhZGVyczogb3B0cy5oZWFkZXJzXG4gICAgfSk7XG4gICAgY29uc3QgdG90YWxTaXplID0gb3B0cy5maWxlcy5yZWR1Y2UoKGFjYywgZik9PmFjYyArIGYuc2l6ZSwgMCk7XG4gICAgbGV0IHRvdGFsTG9hZGVkID0gMDtcbiAgICByZXR1cm4gcmVwb3J0RXZlbnRUb1VUKFwidXBsb2FkXCIsIHtcbiAgICAgICAgaW5wdXQ6IFwiaW5wdXRcIiBpbiBvcHRzID8gb3B0cy5pbnB1dCA6IG51bGwsXG4gICAgICAgIGZpbGVzOiBvcHRzLmZpbGVzLm1hcCgoZik9Pih7XG4gICAgICAgICAgICAgICAgbmFtZTogZi5uYW1lLFxuICAgICAgICAgICAgICAgIHNpemU6IGYuc2l6ZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBmLnR5cGUsXG4gICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBmLmxhc3RNb2RpZmllZFxuICAgICAgICAgICAgfSkpXG4gICAgfSkucGlwZShNaWNyby5mbGF0TWFwKChwcmVzaWduZWRzKT0+TWljcm8uZm9yRWFjaChwcmVzaWduZWRzLCAocHJlc2lnbmVkLCBpKT0+TWljcm8uZmxhdE1hcChNaWNyby5zeW5jKCgpPT5vcHRzLm9uVXBsb2FkQmVnaW4/Lih7XG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IG9wdHMuZmlsZXNbaV0ubmFtZVxuICAgICAgICAgICAgICAgIH0pKSwgKCk9PnVwbG9hZEZpbGUob3B0cy5maWxlc1tpXSwgcHJlc2lnbmVkLCB7XG4gICAgICAgICAgICAgICAgICAgIG9uVXBsb2FkUHJvZ3Jlc3M6IChldik9PntcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkICs9IGV2LmRlbHRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IG9wdHMuZmlsZXNbaV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IE1hdGgucm91bmQoZXYubG9hZGVkIC8gb3B0cy5maWxlc1tpXS5zaXplICogMTAwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZWQ6IGV2LmxvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWx0YTogZXYuZGVsdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQcm9ncmVzczogTWF0aC5yb3VuZCh0b3RhbExvYWRlZCAvIHRvdGFsU2l6ZSAqIDEwMClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpLCB7XG4gICAgICAgICAgICBjb25jdXJyZW5jeTogNlxuICAgICAgICB9KSksIE1pY3JvLnByb3ZpZGVTZXJ2aWNlKEZldGNoQ29udGV4dCwgd2luZG93LmZldGNoKSk7XG59O1xuXG5jb25zdCB2ZXJzaW9uID0gdmVyc2lvbiQxO1xuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IGEgZmlsZSBpcyBvZiBhIHZhbGlkIHR5cGUgZ2l2ZW4gYSByb3V0ZSBjb25maWdcbiAqIEBwdWJsaWNcbiAqLyBjb25zdCBpc1ZhbGlkRmlsZVR5cGUgPSAoZmlsZSwgcm91dGVDb25maWcpPT5NaWNyby5ydW5TeW5jKG1hdGNoRmlsZVR5cGUoZmlsZSwgb2JqZWN0S2V5cyhyb3V0ZUNvbmZpZykpLnBpcGUoTWljcm8ubWFwKCh0eXBlKT0+ZmlsZS50eXBlLmluY2x1ZGVzKHR5cGUpKSwgTWljcm8ub3JFbHNlU3VjY2VlZCgoKT0+ZmFsc2UpKSk7XG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYSBmaWxlIGlzIG9mIGEgdmFsaWQgc2l6ZSBnaXZlbiBhIHJvdXRlIGNvbmZpZ1xuICogQHB1YmxpY1xuICovIGNvbnN0IGlzVmFsaWRGaWxlU2l6ZSA9IChmaWxlLCByb3V0ZUNvbmZpZyk9Pk1pY3JvLnJ1blN5bmMobWF0Y2hGaWxlVHlwZShmaWxlLCBvYmplY3RLZXlzKHJvdXRlQ29uZmlnKSkucGlwZShNaWNyby5mbGF0TWFwKCh0eXBlKT0+ZmlsZVNpemVUb0J5dGVzKHJvdXRlQ29uZmlnW3R5cGVdLm1heEZpbGVTaXplKSksIE1pY3JvLm1hcCgobWF4RmlsZVNpemUpPT5maWxlLnNpemUgPD0gbWF4RmlsZVNpemUpLCBNaWNyby5vckVsc2VTdWNjZWVkKCgpPT5mYWxzZSkpKTtcbi8qKlxuICogR2VuZXJhdGUgYSB0eXBlZCB1cGxvYWRlciBmb3IgYSBnaXZlbiBGaWxlUm91dGVyXG4gKiBAcHVibGljXG4gKi8gY29uc3QgZ2VuVXBsb2FkZXIgPSAoaW5pdE9wdHMpPT57XG4gICAgY29uc3Qgcm91dGVSZWdpc3RyeSA9IGNyZWF0ZUlkZW50aXR5UHJveHkoKTtcbiAgICBjb25zdCBjb250cm9sbGFibGVVcGxvYWQgPSBhc3luYyAoc2x1Zywgb3B0cyk9PntcbiAgICAgICAgY29uc3QgdXBsb2FkcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgY29uc3QgZW5kcG9pbnQgPSB0eXBlb2Ygc2x1ZyA9PT0gXCJmdW5jdGlvblwiID8gc2x1Zyhyb3V0ZVJlZ2lzdHJ5KSA6IHNsdWc7XG4gICAgICAgIGNvbnN0IHV0UmVwb3J0ZXIgPSBjcmVhdGVVVFJlcG9ydGVyKHtcbiAgICAgICAgICAgIGVuZHBvaW50OiBTdHJpbmcoZW5kcG9pbnQpLFxuICAgICAgICAgICAgcGFja2FnZTogaW5pdE9wdHMucGFja2FnZSxcbiAgICAgICAgICAgIHVybDogcmVzb2x2ZU1heWJlVXJsQXJnKGluaXRPcHRzPy51cmwpLFxuICAgICAgICAgICAgaGVhZGVyczogb3B0cy5oZWFkZXJzXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBwcmVzaWduZWRzID0gYXdhaXQgTWljcm8ucnVuUHJvbWlzZSh1dFJlcG9ydGVyKFwidXBsb2FkXCIsIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFzc2lnbm1lbnRcbiAgICAgICAgICAgIGlucHV0OiBcImlucHV0XCIgaW4gb3B0cyA/IG9wdHMuaW5wdXQgOiBudWxsLFxuICAgICAgICAgICAgZmlsZXM6IG9wdHMuZmlsZXMubWFwKChmKT0+KHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZi5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBmLnNpemUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IGYudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBmLmxhc3RNb2RpZmllZFxuICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICB9KS5waXBlKE1pY3JvLnByb3ZpZGVTZXJ2aWNlKEZldGNoQ29udGV4dCwgd2luZG93LmZldGNoKSkpO1xuICAgICAgICBjb25zdCB0b3RhbFNpemUgPSBvcHRzLmZpbGVzLnJlZHVjZSgoYWNjLCBmKT0+YWNjICsgZi5zaXplLCAwKTtcbiAgICAgICAgbGV0IHRvdGFsTG9hZGVkID0gMDtcbiAgICAgICAgY29uc3QgdXBsb2FkRWZmZWN0ID0gKGZpbGUsIHByZXNpZ25lZCk9PnVwbG9hZEZpbGUoZmlsZSwgcHJlc2lnbmVkLCB7XG4gICAgICAgICAgICAgICAgb25VcGxvYWRQcm9ncmVzczogKHByb2dyZXNzRXZlbnQpPT57XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsTG9hZGVkICs9IHByb2dyZXNzRXZlbnQuZGVsdGE7XG4gICAgICAgICAgICAgICAgICAgIG9wdHMub25VcGxvYWRQcm9ncmVzcz8uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnByb2dyZXNzRXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IE1hdGgucm91bmQocHJvZ3Jlc3NFdmVudC5sb2FkZWQgLyBmaWxlLnNpemUgKiAxMDApLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFByb2dyZXNzOiBNYXRoLnJvdW5kKHRvdGFsTG9hZGVkIC8gdG90YWxTaXplICogMTAwKVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5waXBlKE1pY3JvLnByb3ZpZGVTZXJ2aWNlKEZldGNoQ29udGV4dCwgd2luZG93LmZldGNoKSk7XG4gICAgICAgIGZvciAoY29uc3QgW2ksIHBdIG9mIHByZXNpZ25lZHMuZW50cmllcygpKXtcbiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBvcHRzLmZpbGVzW2ldO1xuICAgICAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBjcmVhdGVEZWZlcnJlZCgpO1xuICAgICAgICAgICAgdXBsb2Fkcy5zZXQoZmlsZSwge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLFxuICAgICAgICAgICAgICAgIHByZXNpZ25lZDogcFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2b2lkIE1pY3JvLnJ1blByb21pc2VFeGl0KHVwbG9hZEVmZmVjdChmaWxlLCBwKSwge1xuICAgICAgICAgICAgICAgIHNpZ25hbDogZGVmZXJyZWQuYWMuc2lnbmFsXG4gICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpPT57XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5fdGFnID09PSBcIlJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzdWx0LnJpZ2h0KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5sZWZ0Ll90YWcgPT09IFwiSW50ZXJydXB0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVwbG9hZFBhdXNlZEVycm9yKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRocm93IE1pY3JvLmNhdXNlU3F1YXNoKHJlc3VsdC5sZWZ0KTtcbiAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpPT57XG4gICAgICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFVwbG9hZFBhdXNlZEVycm9yKSByZXR1cm47XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgKiBQYXVzZSBhbiBvbmdvaW5nIHVwbG9hZFxuICAgICAqIEBwYXJhbSBmaWxlIFRoZSBmaWxlIHVwbG9hZCB5b3Ugd2FudCB0byBwYXVzZS4gQ2FuIGJlIG9taXR0ZWQgdG8gcGF1c2UgYWxsIGZpbGVzXG4gICAgICovIGNvbnN0IHBhdXNlVXBsb2FkID0gKGZpbGUpPT57XG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IEFyci5lbnN1cmUoZmlsZSA/PyBvcHRzLmZpbGVzKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcyl7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBsb2FkID0gdXBsb2Fkcy5nZXQoZmlsZSk7XG4gICAgICAgICAgICAgICAgaWYgKCF1cGxvYWQpIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAodXBsb2FkLmRlZmVycmVkLmFjLnNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENhbmNlbCB0aGUgdXBsb2FkIGlmIGl0J3MgYWxyZWFkeSBiZWVuIHBhdXNlZFxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkQWJvcnRlZEVycm9yKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVwbG9hZC5kZWZlcnJlZC5hYy5hYm9ydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgKiBSZXN1bWUgYSBwYXVzZWQgdXBsb2FkXG4gICAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdXBsb2FkIHlvdSB3YW50IHRvIHJlc3VtZS4gQ2FuIGJlIG9taXR0ZWQgdG8gcmVzdW1lIGFsbCBmaWxlc1xuICAgICAqLyBjb25zdCByZXN1bWVVcGxvYWQgPSAoZmlsZSk9PntcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gQXJyLmVuc3VyZShmaWxlID8/IG9wdHMuZmlsZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWQgPSB1cGxvYWRzLmdldChmaWxlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZCkgdGhyb3cgXCJObyB1cGxvYWQgZm91bmRcIjtcbiAgICAgICAgICAgICAgICB1cGxvYWQuZGVmZXJyZWQuYWMgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICAgICAgICAgICAgdm9pZCBNaWNyby5ydW5Qcm9taXNlRXhpdCh1cGxvYWRFZmZlY3QoZmlsZSwgdXBsb2FkLnByZXNpZ25lZCksIHtcbiAgICAgICAgICAgICAgICAgICAgc2lnbmFsOiB1cGxvYWQuZGVmZXJyZWQuYWMuc2lnbmFsXG4gICAgICAgICAgICAgICAgfSkudGhlbigocmVzdWx0KT0+e1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0Ll90YWcgPT09IFwiUmlnaHRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwbG9hZC5kZWZlcnJlZC5yZXNvbHZlKHJlc3VsdC5yaWdodCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LmxlZnQuX3RhZyA9PT0gXCJJbnRlcnJ1cHRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVwbG9hZFBhdXNlZEVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgTWljcm8uY2F1c2VTcXVhc2gocmVzdWx0LmxlZnQpO1xuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpPT57XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBVcGxvYWRQYXVzZWRFcnJvcikgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWQuZGVmZXJyZWQucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAqIFdhaXQgZm9yIGFuIHVwbG9hZCB0byBjb21wbGV0ZVxuICAgICAqIEBwYXJhbSBmaWxlIFRoZSBmaWxlIHVwbG9hZCB5b3Ugd2FudCB0byB3YWl0IGZvci4gQ2FuIGJlIG9taXR0ZWQgdG8gd2FpdCBmb3IgYWxsIGZpbGVzXG4gICAgICovIGNvbnN0IGRvbmUgPSBhc3luYyAoZmlsZSk9PntcbiAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IEFyci5lbnN1cmUoZmlsZSA/PyBvcHRzLmZpbGVzKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcyl7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBsb2FkID0gdXBsb2Fkcy5nZXQoZmlsZSk7XG4gICAgICAgICAgICAgICAgaWYgKCF1cGxvYWQpIHRocm93IFwiTm8gdXBsb2FkIGZvdW5kXCI7XG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaCh1cGxvYWQuZGVmZXJyZWQucHJvbWlzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgICAgICAgcmV0dXJuIGZpbGUgPyByZXN1bHRzWzBdIDogcmVzdWx0cztcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBhdXNlVXBsb2FkLFxuICAgICAgICAgICAgcmVzdW1lVXBsb2FkLFxuICAgICAgICAgICAgZG9uZVxuICAgICAgICB9O1xuICAgIH07XG4gICAgLyoqXG4gICAqIE9uZSBzdGVwIHVwbG9hZCBmdW5jdGlvbiB0aGF0IGJvdGggcmVxdWVzdHMgcHJlc2lnbmVkIFVSTHNcbiAgICogYW5kIHRoZW4gdXBsb2FkcyB0aGUgZmlsZXMgdG8gVXBsb2FkVGhpbmdcbiAgICovIGNvbnN0IHR5cGVkVXBsb2FkRmlsZXMgPSAoc2x1Zywgb3B0cyk9PntcbiAgICAgICAgY29uc3QgZW5kcG9pbnQgPSB0eXBlb2Ygc2x1ZyA9PT0gXCJmdW5jdGlvblwiID8gc2x1Zyhyb3V0ZVJlZ2lzdHJ5KSA6IHNsdWc7XG4gICAgICAgIHJldHVybiB1cGxvYWRGaWxlc0ludGVybmFsKGVuZHBvaW50LCB7XG4gICAgICAgICAgICAuLi5vcHRzLFxuICAgICAgICAgICAgc2tpcFBvbGxpbmc6IHt9LFxuICAgICAgICAgICAgdXJsOiByZXNvbHZlTWF5YmVVcmxBcmcoaW5pdE9wdHM/LnVybCksXG4gICAgICAgICAgICBwYWNrYWdlOiBpbml0T3B0cy5wYWNrYWdlLFxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtbWVtYmVyLWFjY2Vzc1xuICAgICAgICAgICAgaW5wdXQ6IG9wdHMuaW5wdXRcbiAgICAgICAgfSkucGlwZSgoZWZmZWN0KT0+TWljcm8ucnVuUHJvbWlzZUV4aXQoZWZmZWN0LCBvcHRzLnNpZ25hbCAmJiB7XG4gICAgICAgICAgICAgICAgc2lnbmFsOiBvcHRzLnNpZ25hbFxuICAgICAgICAgICAgfSkpLnRoZW4oKGV4aXQpPT57XG4gICAgICAgICAgICBpZiAoZXhpdC5fdGFnID09PSBcIlJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZXhpdC5yaWdodDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXhpdC5sZWZ0Ll90YWcgPT09IFwiSW50ZXJydXB0XCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkQWJvcnRlZEVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aHJvdyBNaWNyby5jYXVzZVNxdWFzaChleGl0LmxlZnQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICAgIHVwbG9hZEZpbGVzOiB0eXBlZFVwbG9hZEZpbGVzLFxuICAgICAgICBjcmVhdGVVcGxvYWQ6IGNvbnRyb2xsYWJsZVVwbG9hZCxcbiAgICAgICAgLyoqXG4gICAgICogSWRlbnRpdHkgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgaW5zdGVhZCBvZiByYXcgc3RyaW5nc1xuICAgICAqIHRoYXQgYWxsb3dzIFwiR28gdG8gZGVmaW5pdGlvblwiIGluIHlvdXIgSURFIHRvIGJyaW5nIHlvdVxuICAgICAqIHRvIHRoZSBiYWNrZW5kIGRlZmluaXRpb24gb2YgYSByb3V0ZS5cbiAgICAgKi8gcm91dGVSZWdpc3RyeVxuICAgIH07XG59O1xuXG5leHBvcnQgeyBnZW5VcGxvYWRlciwgaXNWYWxpZEZpbGVTaXplLCBpc1ZhbGlkRmlsZVR5cGUsIHZlcnNpb24gfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/uploadthing/client/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/internal/types.js":
/*!****************************************************!*\
  !*** ./node_modules/uploadthing/internal/types.js ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* binding */ UTFiles)\n/* harmony export */ });\n/**\n * Marker used to append a `customId` to the incoming file data in `.middleware()`\n * @example\n * ```ts\n * .middleware((opts) => {\n *   return {\n *     [UTFiles]: opts.files.map((file) => ({\n *       ...file,\n *       customId: generateId(),\n *     }))\n *   };\n * })\n * ```\n */ const UTFiles = Symbol(\"uploadthing-custom-id-symbol\");\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvaW50ZXJuYWwvdHlwZXMuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3NhbXBsZTEvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvaW50ZXJuYWwvdHlwZXMuanM/MTA2OSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1hcmtlciB1c2VkIHRvIGFwcGVuZCBhIGBjdXN0b21JZGAgdG8gdGhlIGluY29taW5nIGZpbGUgZGF0YSBpbiBgLm1pZGRsZXdhcmUoKWBcbiAqIEBleGFtcGxlXG4gKiBgYGB0c1xuICogLm1pZGRsZXdhcmUoKG9wdHMpID0+IHtcbiAqICAgcmV0dXJuIHtcbiAqICAgICBbVVRGaWxlc106IG9wdHMuZmlsZXMubWFwKChmaWxlKSA9PiAoe1xuICogICAgICAgLi4uZmlsZSxcbiAqICAgICAgIGN1c3RvbUlkOiBnZW5lcmF0ZUlkKCksXG4gKiAgICAgfSkpXG4gKiAgIH07XG4gKiB9KVxuICogYGBgXG4gKi8gY29uc3QgVVRGaWxlcyA9IFN5bWJvbChcInVwbG9hZHRoaW5nLWN1c3RvbS1pZC1zeW1ib2xcIik7XG5cbmV4cG9ydCB7IFVURmlsZXMgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/internal/types.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/next/index.js":
/*!************************************************!*\
  !*** ./node_modules/uploadthing/next/index.js ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* reexport safe */ _internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles),\n/* harmony export */   createRouteHandler: () => (/* binding */ createRouteHandler),\n/* harmony export */   createUploadthing: () => (/* binding */ createUploadthing)\n/* harmony export */ });\n/* harmony import */ var effect_Effect__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! effect/Effect */ \"(rsc)/./node_modules/effect/dist/esm/Effect.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/FetchHttpClient.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/Headers.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpApp.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpRouter.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClient.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpIncomingMessage.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpBody.js\");\n/* harmony import */ var effect_Config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! effect/Config */ \"(rsc)/./node_modules/effect/dist/esm/Config.js\");\n/* harmony import */ var effect_Context__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! effect/Context */ \"(rsc)/./node_modules/effect/dist/esm/Context.js\");\n/* harmony import */ var effect_Match__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! effect/Match */ \"(rsc)/./node_modules/effect/dist/esm/Match.js\");\n/* harmony import */ var effect_Redacted__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! effect/Redacted */ \"(rsc)/./node_modules/effect/dist/esm/Redacted.js\");\n/* harmony import */ var effect_Schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Schema */ \"(rsc)/./node_modules/effect/dist/esm/Schema.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @uploadthing/shared */ \"(rsc)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/ConfigProvider */ \"(rsc)/./node_modules/effect/dist/esm/ConfigProvider.js\");\n/* harmony import */ var effect_Stream__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! effect/Stream */ \"(rsc)/./node_modules/effect/dist/esm/Stream.js\");\n/* harmony import */ var effect_Layer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! effect/Layer */ \"(rsc)/./node_modules/effect/dist/esm/Layer.js\");\n/* harmony import */ var effect_Logger__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! effect/Logger */ \"(rsc)/./node_modules/effect/dist/esm/Logger.js\");\n/* harmony import */ var effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! effect/LogLevel */ \"(rsc)/./node_modules/effect/dist/esm/LogLevel.js\");\n/* harmony import */ var effect_Data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! effect/Data */ \"(rsc)/./node_modules/effect/dist/esm/Data.js\");\n/* harmony import */ var effect_FiberRef__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! effect/FiberRef */ \"(rsc)/./node_modules/effect/dist/esm/FiberRef.js\");\n/* harmony import */ var effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! effect/ManagedRuntime */ \"(rsc)/./node_modules/effect/dist/esm/ManagedRuntime.js\");\n/* harmony import */ var _internal_types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/types.js */ \"(rsc)/./node_modules/uploadthing/internal/types.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar version = \"7.2.0\";\n\neffect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidContentDispositions);\neffect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidACLs);\n/**\n * Valid options for the `?actionType` query param\n */ const ActionType = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"upload\");\n/**\n * Valid options for the `uploadthing-hook` header\n * for requests coming from UT server\n */ const UploadThingHook = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"callback\", \"error\");\n/**\n * =============================================================================\n * =========================== Configuration ===================================\n * =============================================================================\n */ const DecodeString = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.transform(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromSelf, effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String, {\n    decode: (data)=>new TextDecoder().decode(data),\n    encode: (data)=>new TextEncoder().encode(data)\n});\nconst ParsedToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n    apiKey: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Redacted(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.startsWith(\"sk_\"))),\n    appId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    regions: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NonEmptyArray(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    ingestHost: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n        default: ()=>\"ingest.uploadthing.com\"\n    }))\n});\nconst UploadThingToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromBase64.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(DecodeString), effect_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.parseJson(ParsedToken)));\n/**\n * =============================================================================\n * ======================== File Type Hierarchy ===============================\n * =============================================================================\n */ /**\n * Properties from the web File object, this is what the client sends when initiating an upload\n */ class FileUploadData extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"FileUploadData\")({\n    name: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    size: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Number,\n    type: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    lastModified: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Number.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional)\n}) {\n}\n/**\n * `.middleware()` can add a customId to the incoming file data\n */ class FileUploadDataWithCustomId extends FileUploadData.extend(\"FileUploadDataWithCustomId\")({\n    customId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String)\n}) {\n}\n/**\n * When files are uploaded, we get back\n * - a key\n * - a direct URL for the file\n * - an app-specific URL for the file (useful for scoping eg. for optimization allowed origins)\n * - the hash (md5-hex) of the uploaded file's contents\n */ class UploadedFileData extends FileUploadDataWithCustomId.extend(\"UploadedFileData\")({\n    key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    url: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    appUrl: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    fileHash: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\n/**\n * =============================================================================\n * ======================== Server Response Schemas ============================\n * =============================================================================\n */ class NewPresignedUrl extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"NewPresignedUrl\")({\n    url: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    customId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    name: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\nclass MetadataFetchStreamPart extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchStreamPart\")({\n    payload: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    signature: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    hook: UploadThingHook\n}) {\n}\nclass MetadataFetchResponse extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchResponse\")({\n    ok: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\nclass CallbackResultResponse extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"CallbackResultResponse\")({\n    ok: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\n/**\n * =============================================================================\n * ======================== Client Action Payloads ============================\n * =============================================================================\n */ class UploadActionPayload extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"UploadActionPayload\")({\n    files: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(FileUploadData),\n    input: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n}) {\n}\n\n/**\n * Merge in `import.meta.env` to the built-in `process.env` provider\n * Prefix keys with `UPLOADTHING_` so we can reference just the name.\n * @example\n * process.env.UPLOADTHING_TOKEN = \"foo\"\n * Config.string(\"token\"); // Config<\"foo\">\n */ const envProvider = effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromEnv().pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromMap(new Map(Object.entries((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.filterDefinedObjectValues)(// fuck this I give up. import.meta is a mistake, someone else can fix it\n     null ?? {}))), {\n        pathDelim: \"_\"\n    })), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.nested(\"uploadthing\"), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.constantCase);\n/**\n * Config provider that merges the options from the object\n * and environment variables prefixed with `UPLOADTHING_`.\n * @remarks Options take precedence over environment variables.\n */ const configProvider = (options)=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromJson(options ?? {}).pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>envProvider));\nconst IsDevelopment = effect_Config__WEBPACK_IMPORTED_MODULE_4__.boolean(\"isDev\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.orElse(()=>effect_Config__WEBPACK_IMPORTED_MODULE_4__.succeed(typeof process !== \"undefined\" ? \"development\" : undefined).pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((_)=>_ === \"development\"))), effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(false));\nconst UTToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Config(\"token\", UploadThingToken).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n    ConfigError: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n            code: e._op === \"InvalidData\" ? \"INVALID_SERVER_CONFIG\" : \"MISSING_ENV\",\n            message: e._op === \"InvalidData\" ? \"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.\" : \"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.\",\n            cause: e\n        })\n}));\neffect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"apiUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(\"https://api.uploadthing.com\"), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\nconst IngestUrl = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n    const { regions, ingestHost } = yield* UTToken;\n    const region = regions[0]; // Currently only support 1 region per app\n    return yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"ingestUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(`https://${region}.${ingestHost}`), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\n});\n\nfunction defaultErrorFormatter(error) {\n    return {\n        message: error.message\n    };\n}\nfunction formatError(error, router) {\n    const errorFormatter = router[Object.keys(router)[0]]?._def.errorFormatter ?? defaultErrorFormatter;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return errorFormatter(error);\n}\n\nconst handleJsonLineStream = (schema, onChunk)=>(stream)=>{\n        let buf = \"\";\n        return stream.pipe(effect_Stream__WEBPACK_IMPORTED_MODULE_6__.decodeText(), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect((chunk)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                buf += chunk;\n                // Scan buffer for newlines\n                const parts = buf.split(\"\\n\");\n                const validChunks = [];\n                for (const part of parts){\n                    try {\n                        // Attempt to parse chunk as JSON\n                        validChunks.push(JSON.parse(part));\n                        // Advance buffer if parsing succeeded\n                        buf = buf.slice(part.length + 1);\n                    } catch  {\n                    //\n                    }\n                }\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Received chunks\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"chunk\", chunk), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"parsedChunks\", validChunks), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"buf\", buf));\n                return validChunks;\n            })), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.decodeUnknown(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(schema))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((part)=>onChunk(part))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.runDrain, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleJsonLineStream\"));\n    };\n\nconst withMinimalLogLevel = effect_Config__WEBPACK_IMPORTED_MODULE_4__.logLevel(\"logLevel\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__.Info), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.andThen((level)=>effect_Logger__WEBPACK_IMPORTED_MODULE_8__.minimumLogLevel(level)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid log level\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", e))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"ConfigError\", (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n        code: \"INVALID_SERVER_CONFIG\",\n        message: \"Invalid server configuration\",\n        cause: e\n    })), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.unwrapEffect);\nconst LogFormat = effect_Config__WEBPACK_IMPORTED_MODULE_4__.literal(\"json\", \"logFmt\", \"structured\", \"pretty\")(\"logFormat\");\nconst withLogFormat = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n    const isDev = yield* IsDevelopment;\n    const logFormat = yield* LogFormat.pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(isDev ? \"pretty\" : \"json\"));\n    return effect_Logger__WEBPACK_IMPORTED_MODULE_8__[logFormat];\n}).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"ConfigError\", (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n        code: \"INVALID_SERVER_CONFIG\",\n        message: \"Invalid server configuration\",\n        cause: e\n    })), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.unwrapEffect);\nconst logHttpClientResponse = (message, opts)=>{\n    const mixin = opts?.mixin ?? \"json\";\n    const level = effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__.fromLiteral(opts?.level ?? \"Debug\");\n    return (response)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(mixin !== \"None\" ? response[mixin] : effect_Effect__WEBPACK_IMPORTED_MODULE_5__[\"void\"], ()=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWithLevel(level, `${message} (${response.status})`).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"response\", response)));\n};\nconst logHttpClientError = (message)=>(err)=>err._tag === \"ResponseError\" ? logHttpClientResponse(message, {\n            level: \"Error\"\n        })(err.response) : effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(message).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", err));\n\nfunction getParseFn(parser) {\n    if (typeof parser.parse === \"function\") {\n        return parser.parse;\n    }\n    throw new Error(\"Invalid parser\");\n}\n\nclass FileSizeMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, max, actual){\n        const reason = `You uploaded a ${type} file that was ${(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.bytesToFileSize)(actual)}, but the limit for that type is ${max}`;\n        super({\n            reason\n        });\n        this._tag = \"FileSizeMismatch\";\n        this.name = \"FileSizeMismatchError\";\n    }\n}\nclass FileCountMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, boundtype, bound, actual){\n        const reason = `You uploaded ${actual} file(s) of type '${type}', but the ${boundtype} for that type is ${bound}`;\n        super({\n            reason\n        });\n        this._tag = \"FileCountMismatch\";\n        this.name = \"FileCountMismatchError\";\n    }\n}\n// Verify that the uploaded files doesn't violate the route config,\n// e.g. uploading more videos than allowed, or a file that is larger than allowed.\n// This is double-checked on infra side, but we want to fail early to avoid network latency.\nconst assertFilesMeetConfig = (files, routeConfig)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const counts = {};\n        for (const file of files){\n            const type = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(routeConfig));\n            counts[type] = (counts[type] ?? 0) + 1;\n            const sizeLimit = routeConfig[type]?.maxFileSize;\n            if (!sizeLimit) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(type, \"maxFileSize\");\n            }\n            const sizeLimitBytes = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fileSizeToBytes)(sizeLimit);\n            if (file.size > sizeLimitBytes) {\n                return yield* new FileSizeMismatch(type, sizeLimit, file.size);\n            }\n        }\n        for(const _key in counts){\n            const key = _key;\n            const config = routeConfig[key];\n            if (!config) return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(key);\n            const count = counts[key];\n            const min = config.minFileCount;\n            const max = config.maxFileCount;\n            if (min > max) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid config during file count - minFileCount > maxFileCount\",\n                    cause: `minFileCount must be less than maxFileCount for key ${key}. got: ${min} > ${max}`\n                });\n            }\n            if (count < min) {\n                return yield* new FileCountMismatch(key, \"minimum\", min, count);\n            }\n            if (count > max) {\n                return yield* new FileCountMismatch(key, \"maximum\", max, count);\n            }\n        }\n        return null;\n    });\nconst extractRouterConfig = (router)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(router), (slug)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(router[slug]._def.routerConfig), (config)=>({\n                slug,\n                config\n            })));\n\nconst makeRuntime = (fetch, config)=>{\n    const fetchHttpClient = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.provideMerge(_effect_platform__WEBPACK_IMPORTED_MODULE_11__.layer, effect_Layer__WEBPACK_IMPORTED_MODULE_9__.succeed(_effect_platform__WEBPACK_IMPORTED_MODULE_11__.Fetch, fetch));\n    const withRedactedHeaders = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.effectDiscard(effect_FiberRef__WEBPACK_IMPORTED_MODULE_12__.update(_effect_platform__WEBPACK_IMPORTED_MODULE_13__.currentRedactedNames, (_)=>_.concat([\n            \"x-uploadthing-api-key\"\n        ])));\n    const layer = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.provide(effect_Layer__WEBPACK_IMPORTED_MODULE_9__.mergeAll(withLogFormat, withMinimalLogLevel, fetchHttpClient, withRedactedHeaders), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.setConfigProvider(configProvider(config)));\n    return effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_14__.make(layer);\n};\n\nclass MiddlewareArguments extends effect_Context__WEBPACK_IMPORTED_MODULE_15__.Tag(\"uploadthing/MiddlewareArguments\")() {\n}\nconst makeAdapterHandler = (makeMiddlewareArgs, toRequest, opts, beAdapter)=>{\n    const managed = makeRuntime(opts.config?.fetch, opts.config);\n    const handle = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runtime().then(_effect_platform__WEBPACK_IMPORTED_MODULE_16__.toWebHandlerRuntime));\n    const app = (...args)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runPromise(createRequestHandler(opts, beAdapter))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.provideServiceEffect(MiddlewareArguments, makeMiddlewareArgs(...args)));\n    return async (...args)=>{\n        const result = await handle.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(app(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(toRequest(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"requestHandler\"), managed.runPromise);\n        return result;\n    };\n};\nconst createRequestHandler = (opts, beAdapter)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const isDevelopment = yield* IsDevelopment;\n        const routerConfig = yield* extractRouterConfig(opts.router);\n        const handleDaemon = (()=>{\n            if (opts.config?.handleDaemonPromise) {\n                return opts.config.handleDaemonPromise;\n            }\n            return isDevelopment ? \"void\" : \"await\";\n        })();\n        if (isDevelopment && handleDaemon === \"await\") {\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"INVALID_SERVER_CONFIG\",\n                message: 'handleDaemonPromise: \"await\" is forbidden in development.'\n            });\n        }\n        const GET = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(routerConfig);\n        });\n        const POST = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const { \"uploadthing-hook\": uploadthingHook, \"x-uploadthing-package\": fePackage, \"x-uploadthing-version\": clientVersion } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaHeaders(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                \"uploadthing-hook\": UploadThingHook.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                \"x-uploadthing-package\": effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>\"unknown\"\n                })),\n                \"x-uploadthing-version\": effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>version\n                }))\n            }));\n            if (clientVersion !== version) {\n                const serverVersion = version;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWarning(\"Client version mismatch. Things may not work as expected, please sync your versions to ensure compatibility.\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs({\n                    clientVersion,\n                    serverVersion\n                }));\n            }\n            const { slug, actionType } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_19__.schemaParams(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                actionType: ActionType.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                slug: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n            }));\n            const uploadable = opts.router[slug];\n            if (!uploadable) {\n                const msg = `No file route found for slug ${slug}`;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"NOT_FOUND\",\n                    message: msg\n                });\n            }\n            const { body, fiber } = yield* effect_Match__WEBPACK_IMPORTED_MODULE_20__.value({\n                actionType,\n                uploadthingHook\n            }).pipe(effect_Match__WEBPACK_IMPORTED_MODULE_20__.when({\n                actionType: \"upload\",\n                uploadthingHook: undefined\n            }, ()=>handleUploadAction({\n                    uploadable,\n                    fePackage,\n                    beAdapter,\n                    slug\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_20__.when({\n                actionType: undefined,\n                uploadthingHook: \"callback\"\n            }, ()=>handleCallbackRequest({\n                    uploadable,\n                    fePackage,\n                    beAdapter\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_20__.when({\n                actionType: undefined,\n                uploadthingHook: \"error\"\n            }, ()=>handleErrorRequest({\n                    uploadable\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_20__.orElse(()=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n                    body: null,\n                    fiber: null\n                })));\n            if (fiber) {\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running fiber as daemon\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"handleDaemon\", handleDaemon));\n                if (handleDaemon === \"void\") ; else if (handleDaemon === \"await\") {\n                    yield* fiber.await;\n                } else if (typeof handleDaemon === \"function\") {\n                    handleDaemon(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.runPromise(fiber.await));\n                }\n            }\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Sending response\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"body\", body));\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(body);\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            ParseError: (e)=>_effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(formatError(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: e.message\n                }), opts.router), {\n                    status: 400\n                }),\n            UploadThingError: (e)=>// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                _effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(formatError(e, opts.router), {\n                    status: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.getStatusCodeFromError)(e)\n                })\n        }));\n        const appendResponseHeaders = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(_effect_platform__WEBPACK_IMPORTED_MODULE_17__.setHeader(\"x-uploadthing-version\", version));\n        return _effect_platform__WEBPACK_IMPORTED_MODULE_19__.empty.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_19__.get(\"*\", GET), _effect_platform__WEBPACK_IMPORTED_MODULE_19__.post(\"*\", POST), _effect_platform__WEBPACK_IMPORTED_MODULE_19__.use(appendResponseHeaders));\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"createRequestHandler\"));\nconst handleErrorRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaBodyJson(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            fileKey: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            error: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling error callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable._def.onUploadError({\n                    error: new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"UPLOAD_FAILED\",\n                        message: `Upload failed for ${requestInput.fileKey}: ${requestInput.error}`\n                    }),\n                    fileKey: requestInput.fileKey\n                }),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run onUploadError\",\n                    cause: error\n                })\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Failed to run onUploadError. You probably shouldn't be throwing errors here.\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", error)))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleErrorRequest\"));\nconst handleCallbackRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable, fePackage, beAdapter } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaBodyJson(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            status: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            file: UploadedFileData,\n            metadata: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Record({\n                key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n                value: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n            })\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        /**\n     * Run `.onUploadComplete` as a daemon to prevent the\n     * request from UT to potentially timeout.\n     */ const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const serverData = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n                try: async ()=>uploadable.resolver({\n                        file: requestInput.file,\n                        metadata: requestInput.metadata\n                    }),\n                catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"INTERNAL_SERVER_ERROR\",\n                        message: \"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.\",\n                        cause: error\n                    })\n            });\n            const payload = {\n                fileKey: requestInput.file.key,\n                callbackData: serverData ?? null\n            };\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"'onUploadComplete' callback finished. Sending response to UploadThing:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"callbackData\", payload));\n            const baseUrl = yield* IngestUrl;\n            const httpClient = (yield* _effect_platform__WEBPACK_IMPORTED_MODULE_21__.HttpClient).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_21__.filterStatusOk);\n            yield* _effect_platform__WEBPACK_IMPORTED_MODULE_22__.post(`/callback-result`).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.prependUrl(baseUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.setHeaders({\n                \"x-uploadthing-api-key\": effect_Redacted__WEBPACK_IMPORTED_MODULE_23__.value(apiKey),\n                \"x-uploadthing-version\": version,\n                \"x-uploadthing-be-adapter\": beAdapter,\n                \"x-uploadthing-fe-package\": fePackage\n            }), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.bodyJson(payload), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(httpClient.execute), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError(logHttpClientError(\"Failed to register callback result\")), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.schemaBodyJson(CallbackResultResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tap(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.log(\"Sent callback result to UploadThing\")), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped);\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleCallbackRequest\"));\nconst runRouteMiddleware = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const middlewareArgs = yield* MiddlewareArguments;\n        const { json: { files, input }, uploadable } = opts;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running middleware\");\n        const metadata = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable._def.middleware({\n                    ...middlewareArgs,\n                    input,\n                    files\n                }),\n            catch: (error)=>error instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError ? error : new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run middleware\",\n                    cause: error\n                })\n        });\n        if (metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles] && metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length !== files.length) {\n            const msg = `Expected files override to have the same length as original files, got ${metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length} but expected ${files.length}`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Files override must have the same length as files\",\n                cause: msg\n            });\n        }\n        // Attach customIds from middleware to the files\n        const filesWithCustomIds = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(files, (file, idx)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const theirs = metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles]?.[idx];\n                if (theirs && theirs.size !== file.size) {\n                    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWarning(\"File size mismatch. Reverting to original size\");\n                }\n                return {\n                    name: theirs?.name ?? file.name,\n                    size: file.size,\n                    type: file.type,\n                    customId: theirs?.customId,\n                    lastModified: theirs?.lastModified ?? Date.now()\n                };\n            }));\n        return {\n            metadata,\n            filesWithCustomIds\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"runRouteMiddleware\"));\nconst handleUploadAction = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const httpClient = (yield* _effect_platform__WEBPACK_IMPORTED_MODULE_21__.HttpClient).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_21__.filterStatusOk);\n        const { uploadable, fePackage, beAdapter, slug } = opts;\n        const json = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaBodyJson(UploadActionPayload);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling upload request\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", json));\n        // validate the input\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing user input\");\n        const inputParser = uploadable._def.inputParser;\n        const parsedInput = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>getParseFn(inputParser)(json.input),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: error\n                })\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Input parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"input\", parsedInput));\n        const { metadata, filesWithCustomIds } = yield* runRouteMiddleware({\n            json: {\n                input: parsedInput,\n                files: json.files\n            },\n            uploadable\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing route config\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routerConfig\", uploadable._def.routerConfig));\n        const parsedConfig = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(uploadable._def.routerConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"InvalidRouteConfig\", (err)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid route config\",\n                cause: err\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Route config parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routeConfig\", parsedConfig));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Validating files meet the config requirements\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"files\", json.files));\n        yield* assertFilesMeetConfig(json.files, parsedConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.mapError((e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: `Invalid config: ${e._tag}`,\n                cause: \"reason\" in e ? e.reason : e.message\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Files validated.\");\n        const fileUploadRequests = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(filesWithCustomIds, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(parsedConfig)), (type)=>({\n                    name: file.name,\n                    size: file.size,\n                    type: file.type || type,\n                    lastModified: file.lastModified,\n                    customId: file.customId,\n                    contentDisposition: parsedConfig[type]?.contentDisposition ?? \"inline\",\n                    acl: parsedConfig[type]?.acl\n                }))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            /** Shouldn't happen since config is validated above so just dying is fine I think */ InvalidFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e),\n            UnknownFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e)\n        }));\n        const routeOptions = uploadable._def.routeOptions;\n        const { apiKey, appId } = yield* UTToken;\n        const ingestUrl = yield* IngestUrl;\n        const isDev = yield* IsDevelopment;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Generating presigned URLs\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"fileUploadRequests\", fileUploadRequests), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"ingestUrl\", ingestUrl));\n        const presignedUrls = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(fileUploadRequests, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const key = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateKey)(file, appId, routeOptions.getFileHashParts);\n                const url = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateSignedURL)(`${ingestUrl}/${key}`, apiKey, {\n                    ttlInSeconds: routeOptions.presignedURLTTL,\n                    data: {\n                        \"x-ut-identifier\": appId,\n                        \"x-ut-file-name\": file.name,\n                        \"x-ut-file-size\": file.size,\n                        \"x-ut-file-type\": file.type,\n                        \"x-ut-slug\": slug,\n                        \"x-ut-custom-id\": file.customId,\n                        \"x-ut-content-disposition\": file.contentDisposition,\n                        \"x-ut-acl\": file.acl\n                    }\n                });\n                return {\n                    url,\n                    key\n                };\n            }), {\n            concurrency: \"unbounded\"\n        });\n        const serverReq = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.HttpServerRequest;\n        const requestUrl = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.toURL(serverReq);\n        const devHookRequest = yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"callbackUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(requestUrl.origin + requestUrl.pathname), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((url)=>_effect_platform__WEBPACK_IMPORTED_MODULE_22__.post(url).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.appendUrlParam(\"slug\", slug))));\n        const metadataRequest = _effect_platform__WEBPACK_IMPORTED_MODULE_22__.post(\"/route-metadata\").pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.prependUrl(ingestUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.setHeaders({\n            \"x-uploadthing-api-key\": effect_Redacted__WEBPACK_IMPORTED_MODULE_23__.value(apiKey),\n            \"x-uploadthing-version\": version,\n            \"x-uploadthing-be-adapter\": beAdapter,\n            \"x-uploadthing-fe-package\": fePackage\n        }), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.bodyJson({\n            fileKeys: presignedUrls.map(({ key })=>key),\n            metadata: metadata,\n            isDev,\n            callbackUrl: devHookRequest.url,\n            callbackSlug: slug,\n            awaitServerData: routeOptions.awaitServerData ?? true\n        }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(httpClient.execute));\n        // Send metadata to UT server (non blocking as a daemon)\n        // In dev, keep the stream open and simulate the callback requests as\n        // files complete uploading\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__[\"if\"](isDev, {\n            onTrue: ()=>metadataRequest.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                    onSuccess: logHttpClientResponse(\"Registered metadata\", {\n                        mixin: \"None\"\n                    }),\n                    onFailure: logHttpClientError(\"Failed to register metadata\")\n                }), _effect_platform__WEBPACK_IMPORTED_MODULE_25__.stream, handleJsonLineStream(MetadataFetchStreamPart, (chunk)=>devHookRequest.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.setHeaders({\n                        \"uploadthing-hook\": chunk.hook,\n                        \"x-uploadthing-signature\": chunk.signature\n                    }), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.setBody(_effect_platform__WEBPACK_IMPORTED_MODULE_26__.text(chunk.payload, \"application/json\")), httpClient.execute, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                        onSuccess: logHttpClientResponse(\"Successfully forwarded callback request from dev stream\"),\n                        onFailure: logHttpClientError(\"Failed to forward callback request from dev stream\")\n                    }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(chunk), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.asVoid, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped))),\n            onFalse: ()=>metadataRequest.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                    onSuccess: logHttpClientResponse(\"Registered metadata\"),\n                    onFailure: logHttpClientError(\"Failed to register metadata\")\n                }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.schemaBodyJson(MetadataFetchResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped)\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        const presigneds = presignedUrls.map((p, i)=>({\n                url: p.url,\n                key: p.key,\n                name: fileUploadRequests[i].name,\n                customId: fileUploadRequests[i].customId ?? null\n            }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logInfo(\"Sending presigned URLs to client\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"presignedUrls\", presigneds));\n        return {\n            body: presigneds,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleUploadAction\"));\n\nfunction internalCreateBuilder(initDef = {}) {\n    const _def = {\n        // Default router config\n        routerConfig: {\n            image: {\n                maxFileSize: \"4MB\"\n            }\n        },\n        routeOptions: {\n            awaitServerData: true\n        },\n        inputParser: {\n            parse: ()=>undefined,\n            _input: undefined,\n            _output: undefined\n        },\n        middleware: ()=>({}),\n        onUploadError: ()=>{\n        // noop\n        },\n        errorFormatter: initDef.errorFormatter ?? defaultErrorFormatter,\n        // Overload with properties passed in\n        ...initDef\n    };\n    return {\n        input (userParser) {\n            return internalCreateBuilder({\n                ..._def,\n                inputParser: userParser\n            });\n        },\n        middleware (userMiddleware) {\n            return internalCreateBuilder({\n                ..._def,\n                middleware: userMiddleware\n            });\n        },\n        onUploadComplete (userUploadComplete) {\n            return {\n                _def,\n                resolver: userUploadComplete\n            };\n        },\n        onUploadError (userOnUploadError) {\n            return internalCreateBuilder({\n                ..._def,\n                onUploadError: userOnUploadError\n            });\n        }\n    };\n}\nfunction createBuilder(opts) {\n    return (input, config)=>{\n        return internalCreateBuilder({\n            routerConfig: input,\n            routeOptions: config ?? {},\n            ...opts\n        });\n    };\n}\n\nconst createUploadthing = (opts)=>createBuilder(opts);\nconst createRouteHandler = (opts)=>{\n    const handler = makeAdapterHandler((req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n            req,\n            res: undefined,\n            event: undefined\n        }), (req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed(req), opts, \"nextjs-app\");\n    return {\n        POST: handler,\n        GET: handler\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvbmV4dC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0M7QUFDNkk7QUFDN0k7QUFDRTtBQUNKO0FBQ007QUFDVDtBQUN5UTtBQUNwUDtBQUNoQjtBQUNGO0FBQ0U7QUFDSTtBQUNSO0FBQ1E7QUFDWTtBQUNUO0FBQ0E7O0FBRS9DOztBQUVBLGtEQUFTLElBQUkseUVBQXdCO0FBQ3JDLGtEQUFTLElBQUksMERBQVM7QUFDdEI7QUFDQTtBQUNBLHVCQUF1QixrREFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsa0RBQVM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsb0RBQVcsQ0FBQyw2REFBb0IsRUFBRSxpREFBUTtBQUNuRTtBQUNBO0FBQ0EsQ0FBQztBQUNELG9CQUFvQixpREFBUTtBQUM1QixZQUFZLG1EQUFVLENBQUMsaURBQVEsTUFBTSxxREFBWTtBQUNqRCxXQUFXLGlEQUFRO0FBQ25CLGFBQWEsd0RBQWUsQ0FBQyxpREFBUTtBQUNyQyxnQkFBZ0IsaURBQVEsTUFBTSx1REFBYztBQUM1QztBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0QseUJBQXlCLCtEQUFzQixNQUFNLGtEQUFTLGdCQUFnQixrREFBUyxDQUFDLG9EQUFXO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxnREFBTztBQUN4QyxVQUFVLGlEQUFRO0FBQ2xCLFVBQVUsaURBQVE7QUFDbEIsVUFBVSxpREFBUTtBQUNsQixrQkFBa0IsaURBQVEsTUFBTSxtREFBVTtBQUMxQyxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGlEQUFRLENBQUMsaURBQVE7QUFDL0IsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlEQUFRO0FBQ2pCLFNBQVMsaURBQVE7QUFDakIs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Q1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsOENBQThDLGtEQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLFNBQVMsVUFBVSxrREFBYztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVpRCIsInNvdXJjZXMiOlsid2VicGFjazovL3NhbXBsZTEvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvbmV4dC9pbmRleC5qcz84Y2VkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEVmZmVjdCBmcm9tICdlZmZlY3QvRWZmZWN0JztcbmltcG9ydCB7IEZldGNoSHR0cENsaWVudCwgSGVhZGVycywgSHR0cEFwcCwgSHR0cFNlcnZlclJlc3BvbnNlLCBIdHRwU2VydmVyUmVxdWVzdCwgSHR0cFJvdXRlciwgSHR0cENsaWVudCwgSHR0cENsaWVudFJlcXVlc3QsIEh0dHBDbGllbnRSZXNwb25zZSwgSHR0cEJvZHkgfSBmcm9tICdAZWZmZWN0L3BsYXRmb3JtJztcbmltcG9ydCAqIGFzIENvbmZpZyBmcm9tICdlZmZlY3QvQ29uZmlnJztcbmltcG9ydCAqIGFzIENvbnRleHQgZnJvbSAnZWZmZWN0L0NvbnRleHQnO1xuaW1wb3J0ICogYXMgTWF0Y2ggZnJvbSAnZWZmZWN0L01hdGNoJztcbmltcG9ydCAqIGFzIFJlZGFjdGVkIGZyb20gJ2VmZmVjdC9SZWRhY3RlZCc7XG5pbXBvcnQgKiBhcyBTIGZyb20gJ2VmZmVjdC9TY2hlbWEnO1xuaW1wb3J0IHsgVmFsaWRDb250ZW50RGlzcG9zaXRpb25zLCBWYWxpZEFDTHMsIGZpbHRlckRlZmluZWRPYmplY3RWYWx1ZXMsIFVwbG9hZFRoaW5nRXJyb3IsIG1hdGNoRmlsZVR5cGUsIG9iamVjdEtleXMsIEludmFsaWRSb3V0ZUNvbmZpZ0Vycm9yLCBmaWxlU2l6ZVRvQnl0ZXMsIGZpbGxJbnB1dFJvdXRlQ29uZmlnLCBieXRlc1RvRmlsZVNpemUsIGdldFN0YXR1c0NvZGVGcm9tRXJyb3IsIHZlcmlmeVNpZ25hdHVyZSwgZ2VuZXJhdGVLZXksIGdlbmVyYXRlU2lnbmVkVVJMIH0gZnJvbSAnQHVwbG9hZHRoaW5nL3NoYXJlZCc7XG5pbXBvcnQgKiBhcyBDb25maWdQcm92aWRlciBmcm9tICdlZmZlY3QvQ29uZmlnUHJvdmlkZXInO1xuaW1wb3J0ICogYXMgU3RyZWFtIGZyb20gJ2VmZmVjdC9TdHJlYW0nO1xuaW1wb3J0ICogYXMgTGF5ZXIgZnJvbSAnZWZmZWN0L0xheWVyJztcbmltcG9ydCAqIGFzIExvZ2dlciBmcm9tICdlZmZlY3QvTG9nZ2VyJztcbmltcG9ydCAqIGFzIExvZ0xldmVsIGZyb20gJ2VmZmVjdC9Mb2dMZXZlbCc7XG5pbXBvcnQgKiBhcyBEYXRhIGZyb20gJ2VmZmVjdC9EYXRhJztcbmltcG9ydCAqIGFzIEZpYmVyUmVmIGZyb20gJ2VmZmVjdC9GaWJlclJlZic7XG5pbXBvcnQgKiBhcyBNYW5hZ2VkUnVudGltZSBmcm9tICdlZmZlY3QvTWFuYWdlZFJ1bnRpbWUnO1xuaW1wb3J0IHsgVVRGaWxlcyB9IGZyb20gJy4uL2ludGVybmFsL3R5cGVzLmpzJztcbmV4cG9ydCB7IFVURmlsZXMgfSBmcm9tICcuLi9pbnRlcm5hbC90eXBlcy5qcyc7XG5cbnZhciB2ZXJzaW9uID0gXCI3LjIuMFwiO1xuXG5TLkxpdGVyYWwoLi4uVmFsaWRDb250ZW50RGlzcG9zaXRpb25zKTtcblMuTGl0ZXJhbCguLi5WYWxpZEFDTHMpO1xuLyoqXG4gKiBWYWxpZCBvcHRpb25zIGZvciB0aGUgYD9hY3Rpb25UeXBlYCBxdWVyeSBwYXJhbVxuICovIGNvbnN0IEFjdGlvblR5cGUgPSBTLkxpdGVyYWwoXCJ1cGxvYWRcIik7XG4vKipcbiAqIFZhbGlkIG9wdGlvbnMgZm9yIHRoZSBgdXBsb2FkdGhpbmctaG9va2AgaGVhZGVyXG4gKiBmb3IgcmVxdWVzdHMgY29taW5nIGZyb20gVVQgc2VydmVyXG4gKi8gY29uc3QgVXBsb2FkVGhpbmdIb29rID0gUy5MaXRlcmFsKFwiY2FsbGJhY2tcIiwgXCJlcnJvclwiKTtcbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PSBDb25maWd1cmF0aW9uID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICovIGNvbnN0IERlY29kZVN0cmluZyA9IFMudHJhbnNmb3JtKFMuVWludDhBcnJheUZyb21TZWxmLCBTLlN0cmluZywge1xuICAgIGRlY29kZTogKGRhdGEpPT5uZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZGF0YSksXG4gICAgZW5jb2RlOiAoZGF0YSk9Pm5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShkYXRhKVxufSk7XG5jb25zdCBQYXJzZWRUb2tlbiA9IFMuU3RydWN0KHtcbiAgICBhcGlLZXk6IFMuUmVkYWN0ZWQoUy5TdHJpbmcucGlwZShTLnN0YXJ0c1dpdGgoXCJza19cIikpKSxcbiAgICBhcHBJZDogUy5TdHJpbmcsXG4gICAgcmVnaW9uczogUy5Ob25FbXB0eUFycmF5KFMuU3RyaW5nKSxcbiAgICBpbmdlc3RIb3N0OiBTLlN0cmluZy5waXBlKFMub3B0aW9uYWxXaXRoKHtcbiAgICAgICAgZGVmYXVsdDogKCk9PlwiaW5nZXN0LnVwbG9hZHRoaW5nLmNvbVwiXG4gICAgfSkpXG59KTtcbmNvbnN0IFVwbG9hZFRoaW5nVG9rZW4gPSBTLlVpbnQ4QXJyYXlGcm9tQmFzZTY0LnBpcGUoUy5jb21wb3NlKERlY29kZVN0cmluZyksIFMuY29tcG9zZShTLnBhcnNlSnNvbihQYXJzZWRUb2tlbikpKTtcbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PSBGaWxlIFR5cGUgSGllcmFyY2h5ID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gLyoqXG4gKiBQcm9wZXJ0aWVzIGZyb20gdGhlIHdlYiBGaWxlIG9iamVjdCwgdGhpcyBpcyB3aGF0IHRoZSBjbGllbnQgc2VuZHMgd2hlbiBpbml0aWF0aW5nIGFuIHVwbG9hZFxuICovIGNsYXNzIEZpbGVVcGxvYWREYXRhIGV4dGVuZHMgUy5DbGFzcyhcIkZpbGVVcGxvYWREYXRhXCIpKHtcbiAgICBuYW1lOiBTLlN0cmluZyxcbiAgICBzaXplOiBTLk51bWJlcixcbiAgICB0eXBlOiBTLlN0cmluZyxcbiAgICBsYXN0TW9kaWZpZWQ6IFMuTnVtYmVyLnBpcGUoUy5vcHRpb25hbClcbn0pIHtcbn1cbi8qKlxuICogYC5taWRkbGV3YXJlKClgIGNhbiBhZGQgYSBjdXN0b21JZCB0byB0aGUgaW5jb21pbmcgZmlsZSBkYXRhXG4gKi8gY2xhc3MgRmlsZVVwbG9hZERhdGFXaXRoQ3VzdG9tSWQgZXh0ZW5kcyBGaWxlVXBsb2FkRGF0YS5leHRlbmQoXCJGaWxlVXBsb2FkRGF0YVdpdGhDdXN0b21JZFwiKSh7XG4gICAgY3VzdG9tSWQ6IFMuTnVsbE9yKFMuU3RyaW5nKVxufSkge1xufVxuLyoqXG4gKiBXaGVuIGZpbGVzIGFyZSB1cGxvYWRlZCwgd2UgZ2V0IGJhY2tcbiAqIC0gYSBrZXlcbiAqIC0gYSBkaXJlY3QgVVJMIGZvciB0aGUgZmlsZVxuICogLSBhbiBhcHAtc3BlY2lmaWMgVVJMIGZvciB0aGUgZmlsZSAodXNlZnVsIGZvciBzY29waW5nIGVnLiBmb3Igb3B0aW1pemF0aW9uIGFsbG93ZWQgb3JpZ2lucylcbiAqIC0gdGhlIGhhc2ggKG1kNS1oZXgpIG9mIHRoZSB1cGxvYWRlZCBmaWxlJ3MgY29udGVudHNcbiAqLyBjbGFzcyBVcGxvYWRlZEZpbGVEYXRhIGV4dGVuZHMgRmlsZVVwbG9hZERhdGFXaXRoQ3VzdG9tSWQuZXh0ZW5kKFwiVXBsb2FkZWRGaWxlRGF0YVwiKSh7XG4gICAga2V5OiBTLlN0cmluZyxcbiAgICB1cmw6IFMuU3RyaW5nLFxuICAgIGFwcFVybDogUy5TdHJpbmcsXG4gICAgZmlsZUhhc2g6IFMuU3RyaW5nXG59KSB7XG59XG4vKipcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT0gU2VydmVyIFJlc3BvbnNlIFNjaGVtYXMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqLyBjbGFzcyBOZXdQcmVzaWduZWRVcmwgZXh0ZW5kcyBTLkNsYXNzKFwiTmV3UHJlc2lnbmVkVXJsXCIpKHtcbiAgICB1cmw6IFMuU3RyaW5nLFxuICAgIGtleTogUy5TdHJpbmcsXG4gICAgY3VzdG9tSWQ6IFMuTnVsbE9yKFMuU3RyaW5nKSxcbiAgICBuYW1lOiBTLlN0cmluZ1xufSkge1xufVxuY2xhc3MgTWV0YWRhdGFGZXRjaFN0cmVhbVBhcnQgZXh0ZW5kcyBTLkNsYXNzKFwiTWV0YWRhdGFGZXRjaFN0cmVhbVBhcnRcIikoe1xuICAgIHBheWxvYWQ6IFMuU3RyaW5nLFxuICAgIHNpZ25hdHVyZTogUy5TdHJpbmcsXG4gICAgaG9vazogVXBsb2FkVGhpbmdIb29rXG59KSB7XG59XG5jbGFzcyBNZXRhZGF0YUZldGNoUmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiTWV0YWRhdGFGZXRjaFJlc3BvbnNlXCIpKHtcbiAgICBvazogUy5Cb29sZWFuXG59KSB7XG59XG5jbGFzcyBDYWxsYmFja1Jlc3VsdFJlc3BvbnNlIGV4dGVuZHMgUy5DbGFzcyhcIkNhbGxiYWNrUmVzdWx0UmVzcG9uc2VcIikoe1xuICAgIG9rOiBTLkJvb2xlYW5cbn0pIHtcbn1cbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PSBDbGllbnQgQWN0aW9uIFBheWxvYWRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gY2xhc3MgVXBsb2FkQWN0aW9uUGF5bG9hZCBleHRlbmRzIFMuQ2xhc3MoXCJVcGxvYWRBY3Rpb25QYXlsb2FkXCIpKHtcbiAgICBmaWxlczogUy5BcnJheShGaWxlVXBsb2FkRGF0YSksXG4gICAgaW5wdXQ6IFMuVW5rbm93blxufSkge1xufVxuXG4vKipcbiAqIE1lcmdlIGluIGBpbXBvcnQubWV0YS5lbnZgIHRvIHRoZSBidWlsdC1pbiBgcHJvY2Vzcy5lbnZgIHByb3ZpZGVyXG4gKiBQcmVmaXgga2V5cyB3aXRoIGBVUExPQURUSElOR19gIHNvIHdlIGNhbiByZWZlcmVuY2UganVzdCB0aGUgbmFtZS5cbiAqIEBleGFtcGxlXG4gKiBwcm9jZXNzLmVudi5VUExPQURUSElOR19UT0tFTiA9IFwiZm9vXCJcbiAqIENvbmZpZy5zdHJpbmcoXCJ0b2tlblwiKTsgLy8gQ29uZmlnPFwiZm9vXCI+XG4gKi8gY29uc3QgZW52UHJvdmlkZXIgPSBDb25maWdQcm92aWRlci5mcm9tRW52KCkucGlwZShDb25maWdQcm92aWRlci5vckVsc2UoKCk9PkNvbmZpZ1Byb3ZpZGVyLmZyb21NYXAobmV3IE1hcChPYmplY3QuZW50cmllcyhmaWx0ZXJEZWZpbmVkT2JqZWN0VmFsdWVzKC8vIGZ1Y2sgdGhpcyBJIGdpdmUgdXAuIGltcG9ydC5tZXRhIGlzIGEgbWlzdGFrZSwgc29tZW9uZSBlbHNlIGNhbiBmaXggaXRcbiAgICBpbXBvcnQubWV0YT8uZW52ID8/IHt9KSkpLCB7XG4gICAgICAgIHBhdGhEZWxpbTogXCJfXCJcbiAgICB9KSksIENvbmZpZ1Byb3ZpZGVyLm5lc3RlZChcInVwbG9hZHRoaW5nXCIpLCBDb25maWdQcm92aWRlci5jb25zdGFudENhc2UpO1xuLyoqXG4gKiBDb25maWcgcHJvdmlkZXIgdGhhdCBtZXJnZXMgdGhlIG9wdGlvbnMgZnJvbSB0aGUgb2JqZWN0XG4gKiBhbmQgZW52aXJvbm1lbnQgdmFyaWFibGVzIHByZWZpeGVkIHdpdGggYFVQTE9BRFRISU5HX2AuXG4gKiBAcmVtYXJrcyBPcHRpb25zIHRha2UgcHJlY2VkZW5jZSBvdmVyIGVudmlyb25tZW50IHZhcmlhYmxlcy5cbiAqLyBjb25zdCBjb25maWdQcm92aWRlciA9IChvcHRpb25zKT0+Q29uZmlnUHJvdmlkZXIuZnJvbUpzb24ob3B0aW9ucyA/PyB7fSkucGlwZShDb25maWdQcm92aWRlci5vckVsc2UoKCk9PmVudlByb3ZpZGVyKSk7XG5jb25zdCBJc0RldmVsb3BtZW50ID0gQ29uZmlnLmJvb2xlYW4oXCJpc0RldlwiKS5waXBlKENvbmZpZy5vckVsc2UoKCk9PkNvbmZpZy5zdWNjZWVkKHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiID8gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgOiB1bmRlZmluZWQpLnBpcGUoQ29uZmlnLm1hcCgoXyk9Pl8gPT09IFwiZGV2ZWxvcG1lbnRcIikpKSwgQ29uZmlnLndpdGhEZWZhdWx0KGZhbHNlKSk7XG5jb25zdCBVVFRva2VuID0gUy5Db25maWcoXCJ0b2tlblwiLCBVcGxvYWRUaGluZ1Rva2VuKS5waXBlKEVmZmVjdC5jYXRjaFRhZ3Moe1xuICAgIENvbmZpZ0Vycm9yOiAoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgIGNvZGU6IGUuX29wID09PSBcIkludmFsaWREYXRhXCIgPyBcIklOVkFMSURfU0VSVkVSX0NPTkZJR1wiIDogXCJNSVNTSU5HX0VOVlwiLFxuICAgICAgICAgICAgbWVzc2FnZTogZS5fb3AgPT09IFwiSW52YWxpZERhdGFcIiA/IFwiSW52YWxpZCB0b2tlbi4gQSB0b2tlbiBpcyBhIGJhc2U2NCBlbmNvZGVkIEpTT04gb2JqZWN0IG1hdGNoaW5nIHsgYXBpS2V5OiBzdHJpbmcsIGFwcElkOiBzdHJpbmcsIHJlZ2lvbnM6IHN0cmluZ1tdIH0uXCIgOiBcIk1pc3NpbmcgdG9rZW4uIFBsZWFzZSBzZXQgdGhlIGBVUExPQURUSElOR19UT0tFTmAgZW52aXJvbm1lbnQgdmFyaWFibGUgb3IgcHJvdmlkZSBhIHRva2VuIG1hbnVhbGx5IHRocm91Z2ggY29uZmlnLlwiLFxuICAgICAgICAgICAgY2F1c2U6IGVcbiAgICAgICAgfSlcbn0pKTtcbkNvbmZpZy5zdHJpbmcoXCJhcGlVcmxcIikucGlwZShDb25maWcud2l0aERlZmF1bHQoXCJodHRwczovL2FwaS51cGxvYWR0aGluZy5jb21cIiksIENvbmZpZy5tYXBBdHRlbXB0KChfKT0+bmV3IFVSTChfKSksIENvbmZpZy5tYXAoKHVybCk9PnVybC5ocmVmLnJlcGxhY2UoL1xcLyQvLCBcIlwiKSkpO1xuY29uc3QgSW5nZXN0VXJsID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgY29uc3QgeyByZWdpb25zLCBpbmdlc3RIb3N0IH0gPSB5aWVsZCogVVRUb2tlbjtcbiAgICBjb25zdCByZWdpb24gPSByZWdpb25zWzBdOyAvLyBDdXJyZW50bHkgb25seSBzdXBwb3J0IDEgcmVnaW9uIHBlciBhcHBcbiAgICByZXR1cm4geWllbGQqIENvbmZpZy5zdHJpbmcoXCJpbmdlc3RVcmxcIikucGlwZShDb25maWcud2l0aERlZmF1bHQoYGh0dHBzOi8vJHtyZWdpb259LiR7aW5nZXN0SG9zdH1gKSwgQ29uZmlnLm1hcEF0dGVtcHQoKF8pPT5uZXcgVVJMKF8pKSwgQ29uZmlnLm1hcCgodXJsKT0+dXJsLmhyZWYucmVwbGFjZSgvXFwvJC8sIFwiXCIpKSk7XG59KTtcblxuZnVuY3Rpb24gZGVmYXVsdEVycm9yRm9ybWF0dGVyKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgIH07XG59XG5mdW5jdGlvbiBmb3JtYXRFcnJvcihlcnJvciwgcm91dGVyKSB7XG4gICAgY29uc3QgZXJyb3JGb3JtYXR0ZXIgPSByb3V0ZXJbT2JqZWN0LmtleXMocm91dGVyKVswXV0/Ll9kZWYuZXJyb3JGb3JtYXR0ZXIgPz8gZGVmYXVsdEVycm9yRm9ybWF0dGVyO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLXJldHVyblxuICAgIHJldHVybiBlcnJvckZvcm1hdHRlcihlcnJvcik7XG59XG5cbmNvbnN0IGhhbmRsZUpzb25MaW5lU3RyZWFtID0gKHNjaGVtYSwgb25DaHVuayk9PihzdHJlYW0pPT57XG4gICAgICAgIGxldCBidWYgPSBcIlwiO1xuICAgICAgICByZXR1cm4gc3RyZWFtLnBpcGUoU3RyZWFtLmRlY29kZVRleHQoKSwgU3RyZWFtLm1hcEVmZmVjdCgoY2h1bmspPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgICAgICBidWYgKz0gY2h1bms7XG4gICAgICAgICAgICAgICAgLy8gU2NhbiBidWZmZXIgZm9yIG5ld2xpbmVzXG4gICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBidWYuc3BsaXQoXCJcXG5cIik7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsaWRDaHVua3MgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgcGFydHMpe1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB0byBwYXJzZSBjaHVuayBhcyBKU09OXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWxpZENodW5rcy5wdXNoKEpTT04ucGFyc2UocGFydCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWR2YW5jZSBidWZmZXIgaWYgcGFyc2luZyBzdWNjZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZiA9IGJ1Zi5zbGljZShwYXJ0Lmxlbmd0aCArIDEpO1xuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICB7XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJlY2VpdmVkIGNodW5rc1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJjaHVua1wiLCBjaHVuayksIEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJwYXJzZWRDaHVua3NcIiwgdmFsaWRDaHVua3MpLCBFZmZlY3QuYW5ub3RhdGVMb2dzKFwiYnVmXCIsIGJ1ZikpO1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZENodW5rcztcbiAgICAgICAgICAgIH0pKSwgU3RyZWFtLm1hcEVmZmVjdChTLmRlY29kZVVua25vd24oUy5BcnJheShzY2hlbWEpKSksIFN0cmVhbS5tYXBFZmZlY3QoRWZmZWN0LmZvckVhY2goKHBhcnQpPT5vbkNodW5rKHBhcnQpKSksIFN0cmVhbS5ydW5EcmFpbiwgRWZmZWN0LndpdGhMb2dTcGFuKFwiaGFuZGxlSnNvbkxpbmVTdHJlYW1cIikpO1xuICAgIH07XG5cbmNvbnN0IHdpdGhNaW5pbWFsTG9nTGV2ZWwgPSBDb25maWcubG9nTGV2ZWwoXCJsb2dMZXZlbFwiKS5waXBlKENvbmZpZy53aXRoRGVmYXVsdChMb2dMZXZlbC5JbmZvKSwgRWZmZWN0LmFuZFRoZW4oKGxldmVsKT0+TG9nZ2VyLm1pbmltdW1Mb2dMZXZlbChsZXZlbCkpLCBFZmZlY3QudGFwRXJyb3IoKGUpPT5FZmZlY3QubG9nRXJyb3IoXCJJbnZhbGlkIGxvZyBsZXZlbFwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJlcnJvclwiLCBlKSkpLCBFZmZlY3QuY2F0Y2hUYWcoXCJDb25maWdFcnJvclwiLCAoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgY29kZTogXCJJTlZBTElEX1NFUlZFUl9DT05GSUdcIixcbiAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHNlcnZlciBjb25maWd1cmF0aW9uXCIsXG4gICAgICAgIGNhdXNlOiBlXG4gICAgfSkpLCBMYXllci51bndyYXBFZmZlY3QpO1xuY29uc3QgTG9nRm9ybWF0ID0gQ29uZmlnLmxpdGVyYWwoXCJqc29uXCIsIFwibG9nRm10XCIsIFwic3RydWN0dXJlZFwiLCBcInByZXR0eVwiKShcImxvZ0Zvcm1hdFwiKTtcbmNvbnN0IHdpdGhMb2dGb3JtYXQgPSBFZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICBjb25zdCBpc0RldiA9IHlpZWxkKiBJc0RldmVsb3BtZW50O1xuICAgIGNvbnN0IGxvZ0Zvcm1hdCA9IHlpZWxkKiBMb2dGb3JtYXQucGlwZShDb25maWcud2l0aERlZmF1bHQoaXNEZXYgPyBcInByZXR0eVwiIDogXCJqc29uXCIpKTtcbiAgICByZXR1cm4gTG9nZ2VyW2xvZ0Zvcm1hdF07XG59KS5waXBlKEVmZmVjdC5jYXRjaFRhZyhcIkNvbmZpZ0Vycm9yXCIsIChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICBjb2RlOiBcIklOVkFMSURfU0VSVkVSX0NPTkZJR1wiLFxuICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgc2VydmVyIGNvbmZpZ3VyYXRpb25cIixcbiAgICAgICAgY2F1c2U6IGVcbiAgICB9KSksIExheWVyLnVud3JhcEVmZmVjdCk7XG5jb25zdCBsb2dIdHRwQ2xpZW50UmVzcG9uc2UgPSAobWVzc2FnZSwgb3B0cyk9PntcbiAgICBjb25zdCBtaXhpbiA9IG9wdHM/Lm1peGluID8/IFwianNvblwiO1xuICAgIGNvbnN0IGxldmVsID0gTG9nTGV2ZWwuZnJvbUxpdGVyYWwob3B0cz8ubGV2ZWwgPz8gXCJEZWJ1Z1wiKTtcbiAgICByZXR1cm4gKHJlc3BvbnNlKT0+RWZmZWN0LmZsYXRNYXAobWl4aW4gIT09IFwiTm9uZVwiID8gcmVzcG9uc2VbbWl4aW5dIDogRWZmZWN0LnZvaWQsICgpPT5FZmZlY3QubG9nV2l0aExldmVsKGxldmVsLCBgJHttZXNzYWdlfSAoJHtyZXNwb25zZS5zdGF0dXN9KWApLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJlc3BvbnNlXCIsIHJlc3BvbnNlKSkpO1xufTtcbmNvbnN0IGxvZ0h0dHBDbGllbnRFcnJvciA9IChtZXNzYWdlKT0+KGVycik9PmVyci5fdGFnID09PSBcIlJlc3BvbnNlRXJyb3JcIiA/IGxvZ0h0dHBDbGllbnRSZXNwb25zZShtZXNzYWdlLCB7XG4gICAgICAgICAgICBsZXZlbDogXCJFcnJvclwiXG4gICAgICAgIH0pKGVyci5yZXNwb25zZSkgOiBFZmZlY3QubG9nRXJyb3IobWVzc2FnZSkucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiZXJyb3JcIiwgZXJyKSk7XG5cbmZ1bmN0aW9uIGdldFBhcnNlRm4ocGFyc2VyKSB7XG4gICAgaWYgKHR5cGVvZiBwYXJzZXIucGFyc2UgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXR1cm4gcGFyc2VyLnBhcnNlO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBhcnNlclwiKTtcbn1cblxuY2xhc3MgRmlsZVNpemVNaXNtYXRjaCBleHRlbmRzIERhdGEuRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHR5cGUsIG1heCwgYWN0dWFsKXtcbiAgICAgICAgY29uc3QgcmVhc29uID0gYFlvdSB1cGxvYWRlZCBhICR7dHlwZX0gZmlsZSB0aGF0IHdhcyAke2J5dGVzVG9GaWxlU2l6ZShhY3R1YWwpfSwgYnV0IHRoZSBsaW1pdCBmb3IgdGhhdCB0eXBlIGlzICR7bWF4fWA7XG4gICAgICAgIHN1cGVyKHtcbiAgICAgICAgICAgIHJlYXNvblxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fdGFnID0gXCJGaWxlU2l6ZU1pc21hdGNoXCI7XG4gICAgICAgIHRoaXMubmFtZSA9IFwiRmlsZVNpemVNaXNtYXRjaEVycm9yXCI7XG4gICAgfVxufVxuY2xhc3MgRmlsZUNvdW50TWlzbWF0Y2ggZXh0ZW5kcyBEYXRhLkVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlLCBib3VuZHR5cGUsIGJvdW5kLCBhY3R1YWwpe1xuICAgICAgICBjb25zdCByZWFzb24gPSBgWW91IHVwbG9hZGVkICR7YWN0dWFsfSBmaWxlKHMpIG9mIHR5cGUgJyR7dHlwZX0nLCBidXQgdGhlICR7Ym91bmR0eXBlfSBmb3IgdGhhdCB0eXBlIGlzICR7Ym91bmR9YDtcbiAgICAgICAgc3VwZXIoe1xuICAgICAgICAgICAgcmVhc29uXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90YWcgPSBcIkZpbGVDb3VudE1pc21hdGNoXCI7XG4gICAgICAgIHRoaXMubmFtZSA9IFwiRmlsZUNvdW50TWlzbWF0Y2hFcnJvclwiO1xuICAgIH1cbn1cbi8vIFZlcmlmeSB0aGF0IHRoZSB1cGxvYWRlZCBmaWxlcyBkb2Vzbid0IHZpb2xhdGUgdGhlIHJvdXRlIGNvbmZpZyxcbi8vIGUuZy4gdXBsb2FkaW5nIG1vcmUgdmlkZW9zIHRoYW4gYWxsb3dlZCwgb3IgYSBmaWxlIHRoYXQgaXMgbGFyZ2VyIHRoYW4gYWxsb3dlZC5cbi8vIFRoaXMgaXMgZG91YmxlLWNoZWNrZWQgb24gaW5mcmEgc2lkZSwgYnV0IHdlIHdhbnQgdG8gZmFpbCBlYXJseSB0byBhdm9pZCBuZXR3b3JrIGxhdGVuY3kuXG5jb25zdCBhc3NlcnRGaWxlc01lZXRDb25maWcgPSAoZmlsZXMsIHJvdXRlQ29uZmlnKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IGNvdW50cyA9IHt9O1xuICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpe1xuICAgICAgICAgICAgY29uc3QgdHlwZSA9IHlpZWxkKiBtYXRjaEZpbGVUeXBlKGZpbGUsIG9iamVjdEtleXMocm91dGVDb25maWcpKTtcbiAgICAgICAgICAgIGNvdW50c1t0eXBlXSA9IChjb3VudHNbdHlwZV0gPz8gMCkgKyAxO1xuICAgICAgICAgICAgY29uc3Qgc2l6ZUxpbWl0ID0gcm91dGVDb25maWdbdHlwZV0/Lm1heEZpbGVTaXplO1xuICAgICAgICAgICAgaWYgKCFzaXplTGltaXQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBJbnZhbGlkUm91dGVDb25maWdFcnJvcih0eXBlLCBcIm1heEZpbGVTaXplXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgc2l6ZUxpbWl0Qnl0ZXMgPSB5aWVsZCogZmlsZVNpemVUb0J5dGVzKHNpemVMaW1pdCk7XG4gICAgICAgICAgICBpZiAoZmlsZS5zaXplID4gc2l6ZUxpbWl0Qnl0ZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBGaWxlU2l6ZU1pc21hdGNoKHR5cGUsIHNpemVMaW1pdCwgZmlsZS5zaXplKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IoY29uc3QgX2tleSBpbiBjb3VudHMpe1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gX2tleTtcbiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHJvdXRlQ29uZmlnW2tleV07XG4gICAgICAgICAgICBpZiAoIWNvbmZpZykgcmV0dXJuIHlpZWxkKiBuZXcgSW52YWxpZFJvdXRlQ29uZmlnRXJyb3Ioa2V5KTtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gY291bnRzW2tleV07XG4gICAgICAgICAgICBjb25zdCBtaW4gPSBjb25maWcubWluRmlsZUNvdW50O1xuICAgICAgICAgICAgY29uc3QgbWF4ID0gY29uZmlnLm1heEZpbGVDb3VudDtcbiAgICAgICAgICAgIGlmIChtaW4gPiBtYXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgY29uZmlnIGR1cmluZyBmaWxlIGNvdW50IC0gbWluRmlsZUNvdW50ID4gbWF4RmlsZUNvdW50XCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBgbWluRmlsZUNvdW50IG11c3QgYmUgbGVzcyB0aGFuIG1heEZpbGVDb3VudCBmb3Iga2V5ICR7a2V5fS4gZ290OiAke21pbn0gPiAke21heH1gXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY291bnQgPCBtaW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBGaWxlQ291bnRNaXNtYXRjaChrZXksIFwibWluaW11bVwiLCBtaW4sIGNvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb3VudCA+IG1heCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEZpbGVDb3VudE1pc21hdGNoKGtleSwgXCJtYXhpbXVtXCIsIG1heCwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0pO1xuY29uc3QgZXh0cmFjdFJvdXRlckNvbmZpZyA9IChyb3V0ZXIpPT5FZmZlY3QuZm9yRWFjaChvYmplY3RLZXlzKHJvdXRlciksIChzbHVnKT0+RWZmZWN0Lm1hcChmaWxsSW5wdXRSb3V0ZUNvbmZpZyhyb3V0ZXJbc2x1Z10uX2RlZi5yb3V0ZXJDb25maWcpLCAoY29uZmlnKT0+KHtcbiAgICAgICAgICAgICAgICBzbHVnLFxuICAgICAgICAgICAgICAgIGNvbmZpZ1xuICAgICAgICAgICAgfSkpKTtcblxuY29uc3QgbWFrZVJ1bnRpbWUgPSAoZmV0Y2gsIGNvbmZpZyk9PntcbiAgICBjb25zdCBmZXRjaEh0dHBDbGllbnQgPSBMYXllci5wcm92aWRlTWVyZ2UoRmV0Y2hIdHRwQ2xpZW50LmxheWVyLCBMYXllci5zdWNjZWVkKEZldGNoSHR0cENsaWVudC5GZXRjaCwgZmV0Y2gpKTtcbiAgICBjb25zdCB3aXRoUmVkYWN0ZWRIZWFkZXJzID0gTGF5ZXIuZWZmZWN0RGlzY2FyZChGaWJlclJlZi51cGRhdGUoSGVhZGVycy5jdXJyZW50UmVkYWN0ZWROYW1lcywgKF8pPT5fLmNvbmNhdChbXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYXBpLWtleVwiXG4gICAgICAgIF0pKSk7XG4gICAgY29uc3QgbGF5ZXIgPSBMYXllci5wcm92aWRlKExheWVyLm1lcmdlQWxsKHdpdGhMb2dGb3JtYXQsIHdpdGhNaW5pbWFsTG9nTGV2ZWwsIGZldGNoSHR0cENsaWVudCwgd2l0aFJlZGFjdGVkSGVhZGVycyksIExheWVyLnNldENvbmZpZ1Byb3ZpZGVyKGNvbmZpZ1Byb3ZpZGVyKGNvbmZpZykpKTtcbiAgICByZXR1cm4gTWFuYWdlZFJ1bnRpbWUubWFrZShsYXllcik7XG59O1xuXG5jbGFzcyBNaWRkbGV3YXJlQXJndW1lbnRzIGV4dGVuZHMgQ29udGV4dC5UYWcoXCJ1cGxvYWR0aGluZy9NaWRkbGV3YXJlQXJndW1lbnRzXCIpKCkge1xufVxuY29uc3QgbWFrZUFkYXB0ZXJIYW5kbGVyID0gKG1ha2VNaWRkbGV3YXJlQXJncywgdG9SZXF1ZXN0LCBvcHRzLCBiZUFkYXB0ZXIpPT57XG4gICAgY29uc3QgbWFuYWdlZCA9IG1ha2VSdW50aW1lKG9wdHMuY29uZmlnPy5mZXRjaCwgb3B0cy5jb25maWcpO1xuICAgIGNvbnN0IGhhbmRsZSA9IEVmZmVjdC5wcm9taXNlKCgpPT5tYW5hZ2VkLnJ1bnRpbWUoKS50aGVuKEh0dHBBcHAudG9XZWJIYW5kbGVyUnVudGltZSkpO1xuICAgIGNvbnN0IGFwcCA9ICguLi5hcmdzKT0+RWZmZWN0Lm1hcChFZmZlY3QucHJvbWlzZSgoKT0+bWFuYWdlZC5ydW5Qcm9taXNlKGNyZWF0ZVJlcXVlc3RIYW5kbGVyKG9wdHMsIGJlQWRhcHRlcikpKSwgRWZmZWN0LnByb3ZpZGVTZXJ2aWNlRWZmZWN0KE1pZGRsZXdhcmVBcmd1bWVudHMsIG1ha2VNaWRkbGV3YXJlQXJncyguLi5hcmdzKSkpO1xuICAgIHJldHVybiBhc3luYyAoLi4uYXJncyk9PntcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlLnBpcGUoRWZmZWN0LmFwKGFwcCguLi5hcmdzKSksIEVmZmVjdC5hcCh0b1JlcXVlc3QoLi4uYXJncykpLCBFZmZlY3Qud2l0aExvZ1NwYW4oXCJyZXF1ZXN0SGFuZGxlclwiKSwgbWFuYWdlZC5ydW5Qcm9taXNlKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xufTtcbmNvbnN0IGNyZWF0ZVJlcXVlc3RIYW5kbGVyID0gKG9wdHMsIGJlQWRhcHRlcik9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCBpc0RldmVsb3BtZW50ID0geWllbGQqIElzRGV2ZWxvcG1lbnQ7XG4gICAgICAgIGNvbnN0IHJvdXRlckNvbmZpZyA9IHlpZWxkKiBleHRyYWN0Um91dGVyQ29uZmlnKG9wdHMucm91dGVyKTtcbiAgICAgICAgY29uc3QgaGFuZGxlRGFlbW9uID0gKCgpPT57XG4gICAgICAgICAgICBpZiAob3B0cy5jb25maWc/LmhhbmRsZURhZW1vblByb21pc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0cy5jb25maWcuaGFuZGxlRGFlbW9uUHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpc0RldmVsb3BtZW50ID8gXCJ2b2lkXCIgOiBcImF3YWl0XCI7XG4gICAgICAgIH0pKCk7XG4gICAgICAgIGlmIChpc0RldmVsb3BtZW50ICYmIGhhbmRsZURhZW1vbiA9PT0gXCJhd2FpdFwiKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIklOVkFMSURfU0VSVkVSX0NPTkZJR1wiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdoYW5kbGVEYWVtb25Qcm9taXNlOiBcImF3YWl0XCIgaXMgZm9yYmlkZGVuIGluIGRldmVsb3BtZW50LidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IEdFVCA9IEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBIdHRwU2VydmVyUmVzcG9uc2UuanNvbihyb3V0ZXJDb25maWcpO1xuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgUE9TVCA9IEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgY29uc3QgeyBcInVwbG9hZHRoaW5nLWhvb2tcIjogdXBsb2FkdGhpbmdIb29rLCBcIngtdXBsb2FkdGhpbmctcGFja2FnZVwiOiBmZVBhY2thZ2UsIFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCI6IGNsaWVudFZlcnNpb24gfSA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5zY2hlbWFIZWFkZXJzKFMuU3RydWN0KHtcbiAgICAgICAgICAgICAgICBcInVwbG9hZHRoaW5nLWhvb2tcIjogVXBsb2FkVGhpbmdIb29rLnBpcGUoUy5vcHRpb25hbCksXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXBhY2thZ2VcIjogUy5TdHJpbmcucGlwZShTLm9wdGlvbmFsV2l0aCh7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6ICgpPT5cInVua25vd25cIlxuICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiBTLlN0cmluZy5waXBlKFMub3B0aW9uYWxXaXRoKHtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogKCk9PnZlcnNpb25cbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGlmIChjbGllbnRWZXJzaW9uICE9PSB2ZXJzaW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VydmVyVmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dXYXJuaW5nKFwiQ2xpZW50IHZlcnNpb24gbWlzbWF0Y2guIFRoaW5ncyBtYXkgbm90IHdvcmsgYXMgZXhwZWN0ZWQsIHBsZWFzZSBzeW5jIHlvdXIgdmVyc2lvbnMgdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyh7XG4gICAgICAgICAgICAgICAgICAgIGNsaWVudFZlcnNpb24sXG4gICAgICAgICAgICAgICAgICAgIHNlcnZlclZlcnNpb25cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IHNsdWcsIGFjdGlvblR5cGUgfSA9IHlpZWxkKiBIdHRwUm91dGVyLnNjaGVtYVBhcmFtcyhTLlN0cnVjdCh7XG4gICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogQWN0aW9uVHlwZS5waXBlKFMub3B0aW9uYWwpLFxuICAgICAgICAgICAgICAgIHNsdWc6IFMuU3RyaW5nXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCB1cGxvYWRhYmxlID0gb3B0cy5yb3V0ZXJbc2x1Z107XG4gICAgICAgICAgICBpZiAoIXVwbG9hZGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBtc2cgPSBgTm8gZmlsZSByb3V0ZSBmb3VuZCBmb3Igc2x1ZyAke3NsdWd9YDtcbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiTk9UX0ZPVU5EXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1zZ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBib2R5LCBmaWJlciB9ID0geWllbGQqIE1hdGNoLnZhbHVlKHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlLFxuICAgICAgICAgICAgICAgIHVwbG9hZHRoaW5nSG9va1xuICAgICAgICAgICAgfSkucGlwZShNYXRjaC53aGVuKHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBcInVwbG9hZFwiLFxuICAgICAgICAgICAgICAgIHVwbG9hZHRoaW5nSG9vazogdW5kZWZpbmVkXG4gICAgICAgICAgICB9LCAoKT0+aGFuZGxlVXBsb2FkQWN0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkYWJsZSxcbiAgICAgICAgICAgICAgICAgICAgZmVQYWNrYWdlLFxuICAgICAgICAgICAgICAgICAgICBiZUFkYXB0ZXIsXG4gICAgICAgICAgICAgICAgICAgIHNsdWdcbiAgICAgICAgICAgICAgICB9KSksIE1hdGNoLndoZW4oe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1cGxvYWR0aGluZ0hvb2s6IFwiY2FsbGJhY2tcIlxuICAgICAgICAgICAgfSwgKCk9PmhhbmRsZUNhbGxiYWNrUmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGFibGUsXG4gICAgICAgICAgICAgICAgICAgIGZlUGFja2FnZSxcbiAgICAgICAgICAgICAgICAgICAgYmVBZGFwdGVyXG4gICAgICAgICAgICAgICAgfSkpLCBNYXRjaC53aGVuKHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdXBsb2FkdGhpbmdIb29rOiBcImVycm9yXCJcbiAgICAgICAgICAgIH0sICgpPT5oYW5kbGVFcnJvclJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRhYmxlXG4gICAgICAgICAgICAgICAgfSkpLCBNYXRjaC5vckVsc2UoKCk9PkVmZmVjdC5zdWNjZWVkKHtcbiAgICAgICAgICAgICAgICAgICAgYm9keTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgZmliZXI6IG51bGxcbiAgICAgICAgICAgICAgICB9KSkpO1xuICAgICAgICAgICAgaWYgKGZpYmVyKSB7XG4gICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJ1bm5pbmcgZmliZXIgYXMgZGFlbW9uXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImhhbmRsZURhZW1vblwiLCBoYW5kbGVEYWVtb24pKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlRGFlbW9uID09PSBcInZvaWRcIikgOyBlbHNlIGlmIChoYW5kbGVEYWVtb24gPT09IFwiYXdhaXRcIikge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCogZmliZXIuYXdhaXQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaGFuZGxlRGFlbW9uID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRGFlbW9uKEVmZmVjdC5ydW5Qcm9taXNlKGZpYmVyLmF3YWl0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlNlbmRpbmcgcmVzcG9uc2VcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiYm9keVwiLCBib2R5KSk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIEh0dHBTZXJ2ZXJSZXNwb25zZS5qc29uKGJvZHkpO1xuICAgICAgICB9KS5waXBlKEVmZmVjdC5jYXRjaFRhZ3Moe1xuICAgICAgICAgICAgUGFyc2VFcnJvcjogKGUpPT5IdHRwU2VydmVyUmVzcG9uc2UuanNvbihmb3JtYXRFcnJvcihuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIGlucHV0XCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlLm1lc3NhZ2VcbiAgICAgICAgICAgICAgICB9KSwgb3B0cy5yb3V0ZXIpLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogNDAwXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBVcGxvYWRUaGluZ0Vycm9yOiAoZSk9Pi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgICAgICAgICAgSHR0cFNlcnZlclJlc3BvbnNlLmpzb24oZm9ybWF0RXJyb3IoZSwgb3B0cy5yb3V0ZXIpLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogZ2V0U3RhdHVzQ29kZUZyb21FcnJvcihlKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgYXBwZW5kUmVzcG9uc2VIZWFkZXJzID0gRWZmZWN0Lm1hcChIdHRwU2VydmVyUmVzcG9uc2Uuc2V0SGVhZGVyKFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCIsIHZlcnNpb24pKTtcbiAgICAgICAgcmV0dXJuIEh0dHBSb3V0ZXIuZW1wdHkucGlwZShIdHRwUm91dGVyLmdldChcIipcIiwgR0VUKSwgSHR0cFJvdXRlci5wb3N0KFwiKlwiLCBQT1NUKSwgSHR0cFJvdXRlci51c2UoYXBwZW5kUmVzcG9uc2VIZWFkZXJzKSk7XG4gICAgfSkucGlwZShFZmZlY3Qud2l0aExvZ1NwYW4oXCJjcmVhdGVSZXF1ZXN0SGFuZGxlclwiKSk7XG5jb25zdCBoYW5kbGVFcnJvclJlcXVlc3QgPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCB7IHVwbG9hZGFibGUgfSA9IG9wdHM7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3QuSHR0cFNlcnZlclJlcXVlc3Q7XG4gICAgICAgIGNvbnN0IHsgYXBpS2V5IH0gPSB5aWVsZCogVVRUb2tlbjtcbiAgICAgICAgY29uc3QgdmVyaWZpZWQgPSB5aWVsZCogdmVyaWZ5U2lnbmF0dXJlKCh5aWVsZCogcmVxdWVzdC50ZXh0KSwgcmVxdWVzdC5oZWFkZXJzW1wieC11cGxvYWR0aGluZy1zaWduYXR1cmVcIl0sIGFwaUtleSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoYFNpZ25hdHVyZSB2ZXJpZmllZDogJHt2ZXJpZmllZH1gKTtcbiAgICAgICAgaWYgKCF2ZXJpZmllZCkge1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dFcnJvcihcIkludmFsaWQgc2lnbmF0dXJlXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBzaWduYXR1cmVcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVxdWVzdElucHV0ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUJvZHlKc29uKFMuU3RydWN0KHtcbiAgICAgICAgICAgIGZpbGVLZXk6IFMuU3RyaW5nLFxuICAgICAgICAgICAgZXJyb3I6IFMuU3RyaW5nXG4gICAgICAgIH0pKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkhhbmRsaW5nIGVycm9yIGNhbGxiYWNrIHJlcXVlc3Qgd2l0aCBpbnB1dDpcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwianNvblwiLCByZXF1ZXN0SW5wdXQpKTtcbiAgICAgICAgY29uc3QgZmliZXIgPSB5aWVsZCogRWZmZWN0LnRyeVByb21pc2Uoe1xuICAgICAgICAgICAgdHJ5OiBhc3luYyAoKT0+dXBsb2FkYWJsZS5fZGVmLm9uVXBsb2FkRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBlcnJvcjogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogXCJVUExPQURfRkFJTEVEXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgVXBsb2FkIGZhaWxlZCBmb3IgJHtyZXF1ZXN0SW5wdXQuZmlsZUtleX06ICR7cmVxdWVzdElucHV0LmVycm9yfWBcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgIGZpbGVLZXk6IHJlcXVlc3RJbnB1dC5maWxlS2V5XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaDogKGVycm9yKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBydW4gb25VcGxvYWRFcnJvclwiLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KS5waXBlKEVmZmVjdC50YXBFcnJvcigoZXJyb3IpPT5FZmZlY3QubG9nRXJyb3IoXCJGYWlsZWQgdG8gcnVuIG9uVXBsb2FkRXJyb3IuIFlvdSBwcm9iYWJseSBzaG91bGRuJ3QgYmUgdGhyb3dpbmcgZXJyb3JzIGhlcmUuXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImVycm9yXCIsIGVycm9yKSkpKS5waXBlKEVmZmVjdC5pZ25vcmVMb2dnZWQsIEVmZmVjdC5mb3JrRGFlbW9uKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJvZHk6IG51bGwsXG4gICAgICAgICAgICBmaWJlclxuICAgICAgICB9O1xuICAgIH0pLnBpcGUoRWZmZWN0LndpdGhMb2dTcGFuKFwiaGFuZGxlRXJyb3JSZXF1ZXN0XCIpKTtcbmNvbnN0IGhhbmRsZUNhbGxiYWNrUmVxdWVzdCA9IChvcHRzKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IHsgdXBsb2FkYWJsZSwgZmVQYWNrYWdlLCBiZUFkYXB0ZXIgfSA9IG9wdHM7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3QuSHR0cFNlcnZlclJlcXVlc3Q7XG4gICAgICAgIGNvbnN0IHsgYXBpS2V5IH0gPSB5aWVsZCogVVRUb2tlbjtcbiAgICAgICAgY29uc3QgdmVyaWZpZWQgPSB5aWVsZCogdmVyaWZ5U2lnbmF0dXJlKCh5aWVsZCogcmVxdWVzdC50ZXh0KSwgcmVxdWVzdC5oZWFkZXJzW1wieC11cGxvYWR0aGluZy1zaWduYXR1cmVcIl0sIGFwaUtleSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoYFNpZ25hdHVyZSB2ZXJpZmllZDogJHt2ZXJpZmllZH1gKTtcbiAgICAgICAgaWYgKCF2ZXJpZmllZCkge1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dFcnJvcihcIkludmFsaWQgc2lnbmF0dXJlXCIpO1xuICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBzaWduYXR1cmVcIlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVxdWVzdElucHV0ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUJvZHlKc29uKFMuU3RydWN0KHtcbiAgICAgICAgICAgIHN0YXR1czogUy5TdHJpbmcsXG4gICAgICAgICAgICBmaWxlOiBVcGxvYWRlZEZpbGVEYXRhLFxuICAgICAgICAgICAgbWV0YWRhdGE6IFMuUmVjb3JkKHtcbiAgICAgICAgICAgICAgICBrZXk6IFMuU3RyaW5nLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBTLlVua25vd25cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkhhbmRsaW5nIGNhbGxiYWNrIHJlcXVlc3Qgd2l0aCBpbnB1dDpcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwianNvblwiLCByZXF1ZXN0SW5wdXQpKTtcbiAgICAgICAgLyoqXG4gICAgICogUnVuIGAub25VcGxvYWRDb21wbGV0ZWAgYXMgYSBkYWVtb24gdG8gcHJldmVudCB0aGVcbiAgICAgKiByZXF1ZXN0IGZyb20gVVQgdG8gcG90ZW50aWFsbHkgdGltZW91dC5cbiAgICAgKi8gY29uc3QgZmliZXIgPSB5aWVsZCogRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICBjb25zdCBzZXJ2ZXJEYXRhID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgICAgICAgICB0cnk6IGFzeW5jICgpPT51cGxvYWRhYmxlLnJlc29sdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6IHJlcXVlc3RJbnB1dC5maWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IHJlcXVlc3RJbnB1dC5tZXRhZGF0YVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaDogKGVycm9yKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogXCJJTlRFUk5BTF9TRVJWRVJfRVJST1JcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJ1biBvblVwbG9hZENvbXBsZXRlLiBZb3UgcHJvYmFibHkgc2hvdWxkbid0IGJlIHRocm93aW5nIGVycm9ycyBoZXJlLlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgZmlsZUtleTogcmVxdWVzdElucHV0LmZpbGUua2V5LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrRGF0YTogc2VydmVyRGF0YSA/PyBudWxsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIidvblVwbG9hZENvbXBsZXRlJyBjYWxsYmFjayBmaW5pc2hlZC4gU2VuZGluZyByZXNwb25zZSB0byBVcGxvYWRUaGluZzpcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiY2FsbGJhY2tEYXRhXCIsIHBheWxvYWQpKTtcbiAgICAgICAgICAgIGNvbnN0IGJhc2VVcmwgPSB5aWVsZCogSW5nZXN0VXJsO1xuICAgICAgICAgICAgY29uc3QgaHR0cENsaWVudCA9ICh5aWVsZCogSHR0cENsaWVudC5IdHRwQ2xpZW50KS5waXBlKEh0dHBDbGllbnQuZmlsdGVyU3RhdHVzT2spO1xuICAgICAgICAgICAgeWllbGQqIEh0dHBDbGllbnRSZXF1ZXN0LnBvc3QoYC9jYWxsYmFjay1yZXN1bHRgKS5waXBlKEh0dHBDbGllbnRSZXF1ZXN0LnByZXBlbmRVcmwoYmFzZVVybCksIEh0dHBDbGllbnRSZXF1ZXN0LnNldEhlYWRlcnMoe1xuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1hcGkta2V5XCI6IFJlZGFjdGVkLnZhbHVlKGFwaUtleSksXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogdmVyc2lvbixcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYmUtYWRhcHRlclwiOiBiZUFkYXB0ZXIsXG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWZlLXBhY2thZ2VcIjogZmVQYWNrYWdlXG4gICAgICAgICAgICB9KSwgSHR0cENsaWVudFJlcXVlc3QuYm9keUpzb24ocGF5bG9hZCksIEVmZmVjdC5mbGF0TWFwKGh0dHBDbGllbnQuZXhlY3V0ZSksIEVmZmVjdC50YXBFcnJvcihsb2dIdHRwQ2xpZW50RXJyb3IoXCJGYWlsZWQgdG8gcmVnaXN0ZXIgY2FsbGJhY2sgcmVzdWx0XCIpKSwgRWZmZWN0LmZsYXRNYXAoSHR0cENsaWVudFJlc3BvbnNlLnNjaGVtYUJvZHlKc29uKENhbGxiYWNrUmVzdWx0UmVzcG9uc2UpKSwgRWZmZWN0LnRhcChFZmZlY3QubG9nKFwiU2VudCBjYWxsYmFjayByZXN1bHQgdG8gVXBsb2FkVGhpbmdcIikpLCBFZmZlY3Quc2NvcGVkKTtcbiAgICAgICAgfSkucGlwZShFZmZlY3QuaWdub3JlTG9nZ2VkLCBFZmZlY3QuZm9ya0RhZW1vbik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICAgICAgZmliZXJcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImhhbmRsZUNhbGxiYWNrUmVxdWVzdFwiKSk7XG5jb25zdCBydW5Sb3V0ZU1pZGRsZXdhcmUgPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCBtaWRkbGV3YXJlQXJncyA9IHlpZWxkKiBNaWRkbGV3YXJlQXJndW1lbnRzO1xuICAgICAgICBjb25zdCB7IGpzb246IHsgZmlsZXMsIGlucHV0IH0sIHVwbG9hZGFibGUgfSA9IG9wdHM7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJSdW5uaW5nIG1pZGRsZXdhcmVcIik7XG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgICAgIHRyeTogYXN5bmMgKCk9PnVwbG9hZGFibGUuX2RlZi5taWRkbGV3YXJlKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ubWlkZGxld2FyZUFyZ3MsXG4gICAgICAgICAgICAgICAgICAgIGlucHV0LFxuICAgICAgICAgICAgICAgICAgICBmaWxlc1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2F0Y2g6IChlcnJvcik9PmVycm9yIGluc3RhbmNlb2YgVXBsb2FkVGhpbmdFcnJvciA/IGVycm9yIDogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkZhaWxlZCB0byBydW4gbWlkZGxld2FyZVwiLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG1ldGFkYXRhW1VURmlsZXNdICYmIG1ldGFkYXRhW1VURmlsZXNdLmxlbmd0aCAhPT0gZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBgRXhwZWN0ZWQgZmlsZXMgb3ZlcnJpZGUgdG8gaGF2ZSB0aGUgc2FtZSBsZW5ndGggYXMgb3JpZ2luYWwgZmlsZXMsIGdvdCAke21ldGFkYXRhW1VURmlsZXNdLmxlbmd0aH0gYnV0IGV4cGVjdGVkICR7ZmlsZXMubGVuZ3RofWA7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKG1zZyk7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGaWxlcyBvdmVycmlkZSBtdXN0IGhhdmUgdGhlIHNhbWUgbGVuZ3RoIGFzIGZpbGVzXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IG1zZ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQXR0YWNoIGN1c3RvbUlkcyBmcm9tIG1pZGRsZXdhcmUgdG8gdGhlIGZpbGVzXG4gICAgICAgIGNvbnN0IGZpbGVzV2l0aEN1c3RvbUlkcyA9IHlpZWxkKiBFZmZlY3QuZm9yRWFjaChmaWxlcywgKGZpbGUsIGlkeCk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRoZWlycyA9IG1ldGFkYXRhW1VURmlsZXNdPy5baWR4XTtcbiAgICAgICAgICAgICAgICBpZiAodGhlaXJzICYmIHRoZWlycy5zaXplICE9PSBmaWxlLnNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dXYXJuaW5nKFwiRmlsZSBzaXplIG1pc21hdGNoLiBSZXZlcnRpbmcgdG8gb3JpZ2luYWwgc2l6ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdGhlaXJzPy5uYW1lID8/IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUlkOiB0aGVpcnM/LmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IHRoZWlycz8ubGFzdE1vZGlmaWVkID8/IERhdGUubm93KClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbWV0YWRhdGEsXG4gICAgICAgICAgICBmaWxlc1dpdGhDdXN0b21JZHNcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcInJ1blJvdXRlTWlkZGxld2FyZVwiKSk7XG5jb25zdCBoYW5kbGVVcGxvYWRBY3Rpb24gPSAob3B0cyk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICBjb25zdCBodHRwQ2xpZW50ID0gKHlpZWxkKiBIdHRwQ2xpZW50Lkh0dHBDbGllbnQpLnBpcGUoSHR0cENsaWVudC5maWx0ZXJTdGF0dXNPayk7XG4gICAgICAgIGNvbnN0IHsgdXBsb2FkYWJsZSwgZmVQYWNrYWdlLCBiZUFkYXB0ZXIsIHNsdWcgfSA9IG9wdHM7XG4gICAgICAgIGNvbnN0IGpzb24gPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3Quc2NoZW1hQm9keUpzb24oVXBsb2FkQWN0aW9uUGF5bG9hZCk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJIYW5kbGluZyB1cGxvYWQgcmVxdWVzdFwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJqc29uXCIsIGpzb24pKTtcbiAgICAgICAgLy8gdmFsaWRhdGUgdGhlIGlucHV0XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJQYXJzaW5nIHVzZXIgaW5wdXRcIik7XG4gICAgICAgIGNvbnN0IGlucHV0UGFyc2VyID0gdXBsb2FkYWJsZS5fZGVmLmlucHV0UGFyc2VyO1xuICAgICAgICBjb25zdCBwYXJzZWRJbnB1dCA9IHlpZWxkKiBFZmZlY3QudHJ5UHJvbWlzZSh7XG4gICAgICAgICAgICB0cnk6IGFzeW5jICgpPT5nZXRQYXJzZUZuKGlucHV0UGFyc2VyKShqc29uLmlucHV0KSxcbiAgICAgICAgICAgIGNhdGNoOiAoZXJyb3IpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIGlucHV0XCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlcnJvclxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiSW5wdXQgcGFyc2VkIHN1Y2Nlc3NmdWxseVwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJpbnB1dFwiLCBwYXJzZWRJbnB1dCkpO1xuICAgICAgICBjb25zdCB7IG1ldGFkYXRhLCBmaWxlc1dpdGhDdXN0b21JZHMgfSA9IHlpZWxkKiBydW5Sb3V0ZU1pZGRsZXdhcmUoe1xuICAgICAgICAgICAganNvbjoge1xuICAgICAgICAgICAgICAgIGlucHV0OiBwYXJzZWRJbnB1dCxcbiAgICAgICAgICAgICAgICBmaWxlczoganNvbi5maWxlc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHVwbG9hZGFibGVcbiAgICAgICAgfSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJQYXJzaW5nIHJvdXRlIGNvbmZpZ1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJyb3V0ZXJDb25maWdcIiwgdXBsb2FkYWJsZS5fZGVmLnJvdXRlckNvbmZpZykpO1xuICAgICAgICBjb25zdCBwYXJzZWRDb25maWcgPSB5aWVsZCogZmlsbElucHV0Um91dGVDb25maWcodXBsb2FkYWJsZS5fZGVmLnJvdXRlckNvbmZpZykucGlwZShFZmZlY3QuY2F0Y2hUYWcoXCJJbnZhbGlkUm91dGVDb25maWdcIiwgKGVycik9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHJvdXRlIGNvbmZpZ1wiLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBlcnJcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJSb3V0ZSBjb25maWcgcGFyc2VkIHN1Y2Nlc3NmdWxseVwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJyb3V0ZUNvbmZpZ1wiLCBwYXJzZWRDb25maWcpKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlZhbGlkYXRpbmcgZmlsZXMgbWVldCB0aGUgY29uZmlnIHJlcXVpcmVtZW50c1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJmaWxlc1wiLCBqc29uLmZpbGVzKSk7XG4gICAgICAgIHlpZWxkKiBhc3NlcnRGaWxlc01lZXRDb25maWcoanNvbi5maWxlcywgcGFyc2VkQ29uZmlnKS5waXBlKEVmZmVjdC5tYXBFcnJvcigoZSk9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYEludmFsaWQgY29uZmlnOiAke2UuX3RhZ31gLFxuICAgICAgICAgICAgICAgIGNhdXNlOiBcInJlYXNvblwiIGluIGUgPyBlLnJlYXNvbiA6IGUubWVzc2FnZVxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkZpbGVzIHZhbGlkYXRlZC5cIik7XG4gICAgICAgIGNvbnN0IGZpbGVVcGxvYWRSZXF1ZXN0cyA9IHlpZWxkKiBFZmZlY3QuZm9yRWFjaChmaWxlc1dpdGhDdXN0b21JZHMsIChmaWxlKT0+RWZmZWN0Lm1hcChtYXRjaEZpbGVUeXBlKGZpbGUsIG9iamVjdEtleXMocGFyc2VkQ29uZmlnKSksICh0eXBlKT0+KHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSB8fCB0eXBlLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGZpbGUubGFzdE1vZGlmaWVkLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21JZDogZmlsZS5jdXN0b21JZCxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudERpc3Bvc2l0aW9uOiBwYXJzZWRDb25maWdbdHlwZV0/LmNvbnRlbnREaXNwb3NpdGlvbiA/PyBcImlubGluZVwiLFxuICAgICAgICAgICAgICAgICAgICBhY2w6IHBhcnNlZENvbmZpZ1t0eXBlXT8uYWNsXG4gICAgICAgICAgICAgICAgfSkpKS5waXBlKEVmZmVjdC5jYXRjaFRhZ3Moe1xuICAgICAgICAgICAgLyoqIFNob3VsZG4ndCBoYXBwZW4gc2luY2UgY29uZmlnIGlzIHZhbGlkYXRlZCBhYm92ZSBzbyBqdXN0IGR5aW5nIGlzIGZpbmUgSSB0aGluayAqLyBJbnZhbGlkRmlsZVR5cGU6IChlKT0+RWZmZWN0LmRpZShlKSxcbiAgICAgICAgICAgIFVua25vd25GaWxlVHlwZTogKGUpPT5FZmZlY3QuZGllKGUpXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3Qgcm91dGVPcHRpb25zID0gdXBsb2FkYWJsZS5fZGVmLnJvdXRlT3B0aW9ucztcbiAgICAgICAgY29uc3QgeyBhcGlLZXksIGFwcElkIH0gPSB5aWVsZCogVVRUb2tlbjtcbiAgICAgICAgY29uc3QgaW5nZXN0VXJsID0geWllbGQqIEluZ2VzdFVybDtcbiAgICAgICAgY29uc3QgaXNEZXYgPSB5aWVsZCogSXNEZXZlbG9wbWVudDtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkdlbmVyYXRpbmcgcHJlc2lnbmVkIFVSTHNcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiZmlsZVVwbG9hZFJlcXVlc3RzXCIsIGZpbGVVcGxvYWRSZXF1ZXN0cyksIEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJpbmdlc3RVcmxcIiwgaW5nZXN0VXJsKSk7XG4gICAgICAgIGNvbnN0IHByZXNpZ25lZFVybHMgPSB5aWVsZCogRWZmZWN0LmZvckVhY2goZmlsZVVwbG9hZFJlcXVlc3RzLCAoZmlsZSk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IHlpZWxkKiBnZW5lcmF0ZUtleShmaWxlLCBhcHBJZCwgcm91dGVPcHRpb25zLmdldEZpbGVIYXNoUGFydHMpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IHlpZWxkKiBnZW5lcmF0ZVNpZ25lZFVSTChgJHtpbmdlc3RVcmx9LyR7a2V5fWAsIGFwaUtleSwge1xuICAgICAgICAgICAgICAgICAgICB0dGxJblNlY29uZHM6IHJvdXRlT3B0aW9ucy5wcmVzaWduZWRVUkxUVEwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11dC1pZGVudGlmaWVyXCI6IGFwcElkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWZpbGUtbmFtZVwiOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtZmlsZS1zaXplXCI6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11dC1maWxlLXR5cGVcIjogZmlsZS50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LXNsdWdcIjogc2x1ZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11dC1jdXN0b20taWRcIjogZmlsZS5jdXN0b21JZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11dC1jb250ZW50LWRpc3Bvc2l0aW9uXCI6IGZpbGUuY29udGVudERpc3Bvc2l0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWFjbFwiOiBmaWxlLmFjbFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsLFxuICAgICAgICAgICAgICAgICAgICBrZXlcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSksIHtcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5OiBcInVuYm91bmRlZFwiXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzZXJ2ZXJSZXEgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3QuSHR0cFNlcnZlclJlcXVlc3Q7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RVcmwgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3QudG9VUkwoc2VydmVyUmVxKTtcbiAgICAgICAgY29uc3QgZGV2SG9va1JlcXVlc3QgPSB5aWVsZCogQ29uZmlnLnN0cmluZyhcImNhbGxiYWNrVXJsXCIpLnBpcGUoQ29uZmlnLndpdGhEZWZhdWx0KHJlcXVlc3RVcmwub3JpZ2luICsgcmVxdWVzdFVybC5wYXRobmFtZSksIEVmZmVjdC5tYXAoKHVybCk9Pkh0dHBDbGllbnRSZXF1ZXN0LnBvc3QodXJsKS5waXBlKEh0dHBDbGllbnRSZXF1ZXN0LmFwcGVuZFVybFBhcmFtKFwic2x1Z1wiLCBzbHVnKSkpKTtcbiAgICAgICAgY29uc3QgbWV0YWRhdGFSZXF1ZXN0ID0gSHR0cENsaWVudFJlcXVlc3QucG9zdChcIi9yb3V0ZS1tZXRhZGF0YVwiKS5waXBlKEh0dHBDbGllbnRSZXF1ZXN0LnByZXBlbmRVcmwoaW5nZXN0VXJsKSwgSHR0cENsaWVudFJlcXVlc3Quc2V0SGVhZGVycyh7XG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctYXBpLWtleVwiOiBSZWRhY3RlZC52YWx1ZShhcGlLZXkpLFxuICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogdmVyc2lvbixcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1iZS1hZGFwdGVyXCI6IGJlQWRhcHRlcixcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1mZS1wYWNrYWdlXCI6IGZlUGFja2FnZVxuICAgICAgICB9KSwgSHR0cENsaWVudFJlcXVlc3QuYm9keUpzb24oe1xuICAgICAgICAgICAgZmlsZUtleXM6IHByZXNpZ25lZFVybHMubWFwKCh7IGtleSB9KT0+a2V5KSxcbiAgICAgICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSxcbiAgICAgICAgICAgIGlzRGV2LFxuICAgICAgICAgICAgY2FsbGJhY2tVcmw6IGRldkhvb2tSZXF1ZXN0LnVybCxcbiAgICAgICAgICAgIGNhbGxiYWNrU2x1Zzogc2x1ZyxcbiAgICAgICAgICAgIGF3YWl0U2VydmVyRGF0YTogcm91dGVPcHRpb25zLmF3YWl0U2VydmVyRGF0YSA/PyB0cnVlXG4gICAgICAgIH0pLCBFZmZlY3QuZmxhdE1hcChodHRwQ2xpZW50LmV4ZWN1dGUpKTtcbiAgICAgICAgLy8gU2VuZCBtZXRhZGF0YSB0byBVVCBzZXJ2ZXIgKG5vbiBibG9ja2luZyBhcyBhIGRhZW1vbilcbiAgICAgICAgLy8gSW4gZGV2LCBrZWVwIHRoZSBzdHJlYW0gb3BlbiBhbmQgc2ltdWxhdGUgdGhlIGNhbGxiYWNrIHJlcXVlc3RzIGFzXG4gICAgICAgIC8vIGZpbGVzIGNvbXBsZXRlIHVwbG9hZGluZ1xuICAgICAgICBjb25zdCBmaWJlciA9IHlpZWxkKiBFZmZlY3QuaWYoaXNEZXYsIHtcbiAgICAgICAgICAgIG9uVHJ1ZTogKCk9Pm1ldGFkYXRhUmVxdWVzdC5waXBlKEVmZmVjdC50YXBCb3RoKHtcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBsb2dIdHRwQ2xpZW50UmVzcG9uc2UoXCJSZWdpc3RlcmVkIG1ldGFkYXRhXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1peGluOiBcIk5vbmVcIlxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlOiBsb2dIdHRwQ2xpZW50RXJyb3IoXCJGYWlsZWQgdG8gcmVnaXN0ZXIgbWV0YWRhdGFcIilcbiAgICAgICAgICAgICAgICB9KSwgSHR0cENsaWVudFJlc3BvbnNlLnN0cmVhbSwgaGFuZGxlSnNvbkxpbmVTdHJlYW0oTWV0YWRhdGFGZXRjaFN0cmVhbVBhcnQsIChjaHVuayk9PmRldkhvb2tSZXF1ZXN0LnBpcGUoSHR0cENsaWVudFJlcXVlc3Quc2V0SGVhZGVycyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInVwbG9hZHRoaW5nLWhvb2tcIjogY2h1bmsuaG9vayxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1zaWduYXR1cmVcIjogY2h1bmsuc2lnbmF0dXJlXG4gICAgICAgICAgICAgICAgICAgIH0pLCBIdHRwQ2xpZW50UmVxdWVzdC5zZXRCb2R5KEh0dHBCb2R5LnRleHQoY2h1bmsucGF5bG9hZCwgXCJhcHBsaWNhdGlvbi9qc29uXCIpKSwgaHR0cENsaWVudC5leGVjdXRlLCBFZmZlY3QudGFwQm90aCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IGxvZ0h0dHBDbGllbnRSZXNwb25zZShcIlN1Y2Nlc3NmdWxseSBmb3J3YXJkZWQgY2FsbGJhY2sgcmVxdWVzdCBmcm9tIGRldiBzdHJlYW1cIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IGxvZ0h0dHBDbGllbnRFcnJvcihcIkZhaWxlZCB0byBmb3J3YXJkIGNhbGxiYWNrIHJlcXVlc3QgZnJvbSBkZXYgc3RyZWFtXCIpXG4gICAgICAgICAgICAgICAgICAgIH0pLCBFZmZlY3QuYW5ub3RhdGVMb2dzKGNodW5rKSwgRWZmZWN0LmFzVm9pZCwgRWZmZWN0Lmlnbm9yZUxvZ2dlZCwgRWZmZWN0LnNjb3BlZCkpKSxcbiAgICAgICAgICAgIG9uRmFsc2U6ICgpPT5tZXRhZGF0YVJlcXVlc3QucGlwZShFZmZlY3QudGFwQm90aCh7XG4gICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogbG9nSHR0cENsaWVudFJlc3BvbnNlKFwiUmVnaXN0ZXJlZCBtZXRhZGF0YVwiKSxcbiAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlOiBsb2dIdHRwQ2xpZW50RXJyb3IoXCJGYWlsZWQgdG8gcmVnaXN0ZXIgbWV0YWRhdGFcIilcbiAgICAgICAgICAgICAgICB9KSwgRWZmZWN0LmZsYXRNYXAoSHR0cENsaWVudFJlc3BvbnNlLnNjaGVtYUJvZHlKc29uKE1ldGFkYXRhRmV0Y2hSZXNwb25zZSkpLCBFZmZlY3Quc2NvcGVkKVxuICAgICAgICB9KS5waXBlKEVmZmVjdC5mb3JrRGFlbW9uKTtcbiAgICAgICAgY29uc3QgcHJlc2lnbmVkcyA9IHByZXNpZ25lZFVybHMubWFwKChwLCBpKT0+KHtcbiAgICAgICAgICAgICAgICB1cmw6IHAudXJsLFxuICAgICAgICAgICAgICAgIGtleTogcC5rZXksXG4gICAgICAgICAgICAgICAgbmFtZTogZmlsZVVwbG9hZFJlcXVlc3RzW2ldLm5hbWUsXG4gICAgICAgICAgICAgICAgY3VzdG9tSWQ6IGZpbGVVcGxvYWRSZXF1ZXN0c1tpXS5jdXN0b21JZCA/PyBudWxsXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nSW5mbyhcIlNlbmRpbmcgcHJlc2lnbmVkIFVSTHMgdG8gY2xpZW50XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInByZXNpZ25lZFVybHNcIiwgcHJlc2lnbmVkcykpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYm9keTogcHJlc2lnbmVkcyxcbiAgICAgICAgICAgIGZpYmVyXG4gICAgICAgIH07XG4gICAgfSkucGlwZShFZmZlY3Qud2l0aExvZ1NwYW4oXCJoYW5kbGVVcGxvYWRBY3Rpb25cIikpO1xuXG5mdW5jdGlvbiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoaW5pdERlZiA9IHt9KSB7XG4gICAgY29uc3QgX2RlZiA9IHtcbiAgICAgICAgLy8gRGVmYXVsdCByb3V0ZXIgY29uZmlnXG4gICAgICAgIHJvdXRlckNvbmZpZzoge1xuICAgICAgICAgICAgaW1hZ2U6IHtcbiAgICAgICAgICAgICAgICBtYXhGaWxlU2l6ZTogXCI0TUJcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByb3V0ZU9wdGlvbnM6IHtcbiAgICAgICAgICAgIGF3YWl0U2VydmVyRGF0YTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBpbnB1dFBhcnNlcjoge1xuICAgICAgICAgICAgcGFyc2U6ICgpPT51bmRlZmluZWQsXG4gICAgICAgICAgICBfaW5wdXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIF9vdXRwdXQ6IHVuZGVmaW5lZFxuICAgICAgICB9LFxuICAgICAgICBtaWRkbGV3YXJlOiAoKT0+KHt9KSxcbiAgICAgICAgb25VcGxvYWRFcnJvcjogKCk9PntcbiAgICAgICAgLy8gbm9vcFxuICAgICAgICB9LFxuICAgICAgICBlcnJvckZvcm1hdHRlcjogaW5pdERlZi5lcnJvckZvcm1hdHRlciA/PyBkZWZhdWx0RXJyb3JGb3JtYXR0ZXIsXG4gICAgICAgIC8vIE92ZXJsb2FkIHdpdGggcHJvcGVydGllcyBwYXNzZWQgaW5cbiAgICAgICAgLi4uaW5pdERlZlxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5wdXQgKHVzZXJQYXJzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIC4uLl9kZWYsXG4gICAgICAgICAgICAgICAgaW5wdXRQYXJzZXI6IHVzZXJQYXJzZXJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBtaWRkbGV3YXJlICh1c2VyTWlkZGxld2FyZSkge1xuICAgICAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICAgICAgLi4uX2RlZixcbiAgICAgICAgICAgICAgICBtaWRkbGV3YXJlOiB1c2VyTWlkZGxld2FyZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uVXBsb2FkQ29tcGxldGUgKHVzZXJVcGxvYWRDb21wbGV0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBfZGVmLFxuICAgICAgICAgICAgICAgIHJlc29sdmVyOiB1c2VyVXBsb2FkQ29tcGxldGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIG9uVXBsb2FkRXJyb3IgKHVzZXJPblVwbG9hZEVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxDcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICAuLi5fZGVmLFxuICAgICAgICAgICAgICAgIG9uVXBsb2FkRXJyb3I6IHVzZXJPblVwbG9hZEVycm9yXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59XG5mdW5jdGlvbiBjcmVhdGVCdWlsZGVyKG9wdHMpIHtcbiAgICByZXR1cm4gKGlucHV0LCBjb25maWcpPT57XG4gICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgcm91dGVyQ29uZmlnOiBpbnB1dCxcbiAgICAgICAgICAgIHJvdXRlT3B0aW9uczogY29uZmlnID8/IHt9LFxuICAgICAgICAgICAgLi4ub3B0c1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuXG5jb25zdCBjcmVhdGVVcGxvYWR0aGluZyA9IChvcHRzKT0+Y3JlYXRlQnVpbGRlcihvcHRzKTtcbmNvbnN0IGNyZWF0ZVJvdXRlSGFuZGxlciA9IChvcHRzKT0+e1xuICAgIGNvbnN0IGhhbmRsZXIgPSBtYWtlQWRhcHRlckhhbmRsZXIoKHJlcSk9PkVmZmVjdC5zdWNjZWVkKHtcbiAgICAgICAgICAgIHJlcSxcbiAgICAgICAgICAgIHJlczogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZXZlbnQ6IHVuZGVmaW5lZFxuICAgICAgICB9KSwgKHJlcSk9PkVmZmVjdC5zdWNjZWVkKHJlcSksIG9wdHMsIFwibmV4dGpzLWFwcFwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBQT1NUOiBoYW5kbGVyLFxuICAgICAgICBHRVQ6IGhhbmRsZXJcbiAgICB9O1xufTtcblxuZXhwb3J0IHsgY3JlYXRlUm91dGVIYW5kbGVyLCBjcmVhdGVVcGxvYWR0aGluZyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/next/index.js\n");

/***/ })

};
;